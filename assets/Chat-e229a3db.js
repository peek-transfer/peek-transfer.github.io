import{d as G,r as x,e as l,c as d,H as se,I as pe,b as o,J as we,p as m,j as C,x as ye,F as D,k as xe,z as ke,n as U,E as L,y as g,q as de,s as ue,v as fe,K as ge,h as F,L as le,t as M,l as z,w as Se,M as $e,N as Te,T as Ce,O as je,A as Pe,o as Ae,B as Me,G as Ie}from"./index-8fcf0c3d.js";import{f as Oe,M as J,F as K,_ as ve,a as q,V as X,g as Ve,h as ae,j as ee,b as R,e as Fe,k as Be,u as Ee,l as Le,d as Ne,m as Re}from"./usePeek-162624c3.js";const Ue={class:"flex flex-wrap justify-end rounded-lg bg-stone-200 m-2 p-2 rounded md:shadow-md"},De=["onKeypress"],We={class:"flex items-center"},Ge={class:"flex"},He=o("div",{class:"icon icon-base bg-stone-500 i-mdi:paperclip"},null,-1),Ke=[He],ze=["disabled"],qe=G({__name:"ChatInput",emits:["sendText","sendFile"],setup(e,{emit:s}){const n=x(""),a=()=>{n.value.length!==0&&(s("sendText",n.value),n.value="")},{showFilePicker:u,handleFileDrop:i}=Oe({onChange:c=>{s("sendFile",c)}});return(c,t)=>(l(),d("div",Ue,[se(o("input",{"onUpdate:modelValue":t[0]||(t[0]=f=>n.value=f),autofocus:"",class:"flex-1 bg-transparent outline-none",maxlength:"500",type:"text",placeholder:"Type here",onKeypress:we(a,["enter"])},null,40,De),[[pe,n.value]]),o("div",We,[o("div",Ge,[o("button",{class:"icon-contrast-button mr-2",onClick:t[1]||(t[1]=f=>m(u)())},Ke)]),o("button",{class:"primary-button",disabled:n.value.length===0,onClick:a},C(c.$t("send")),9,ze)])]))}});var Je=typeof global=="object"&&global&&global.Object===Object&&global;const Xe=Je;var Qe=typeof self=="object"&&self&&self.Object===Object&&self,Ye=Xe||Qe||Function("return this")();const me=Ye;var Ze=me.Symbol;const Q=Ze;var he=Object.prototype,et=he.hasOwnProperty,tt=he.toString,N=Q?Q.toStringTag:void 0;function nt(e){var s=et.call(e,N),n=e[N];try{e[N]=void 0;var a=!0}catch(i){}var u=tt.call(e);return a&&(s?e[N]=n:delete e[N]),u}var st=Object.prototype,ot=st.toString;function lt(e){return ot.call(e)}var at="[object Null]",it="[object Undefined]",ie=Q?Q.toStringTag:void 0;function ct(e){return e==null?e===void 0?it:at:ie&&ie in Object(e)?nt(e):lt(e)}function rt(e){return e!=null&&typeof e=="object"}var dt="[object Symbol]";function ut(e){return typeof e=="symbol"||rt(e)&&ct(e)==dt}var ft=/\s/;function vt(e){for(var s=e.length;s--&&ft.test(e.charAt(s)););return s}var mt=/^\s+/;function ht(e){return e&&e.slice(0,vt(e)+1).replace(mt,"")}function oe(e){var s=typeof e;return e!=null&&(s=="object"||s=="function")}var ce=0/0,_t=/^[-+]0x[0-9a-f]+$/i,bt=/^0b[01]+$/i,pt=/^0o[0-7]+$/i,wt=parseInt;function re(e){if(typeof e=="number")return e;if(ut(e))return ce;if(oe(e)){var s=typeof e.valueOf=="function"?e.valueOf():e;e=oe(s)?s+"":s}if(typeof e!="string")return e===0?e:+e;e=ht(e);var n=bt.test(e);return n||pt.test(e)?wt(e.slice(2),n?2:8):_t.test(e)?ce:+e}var yt=function(){return me.Date.now()};const te=yt;var xt="Expected a function",kt=Math.max,gt=Math.min;function St(e,s,n){var a,u,i,c,t,f,v=0,S=!1,y=!1,r=!0;if(typeof e!="function")throw new TypeError(xt);s=re(s)||0,oe(n)&&(S=!!n.leading,y="maxWait"in n,i=y?kt(re(n.maxWait)||0,s):i,r="trailing"in n?!!n.trailing:r);function _(h){var T=a,A=u;return a=u=void 0,v=h,c=e.apply(A,T),c}function w(h){return v=h,t=setTimeout(k,s),S?_(h):c}function b(h){var T=h-f,A=h-v,Z=s-T;return y?gt(Z,i-A):Z}function p(h){var T=h-f,A=h-v;return f===void 0||T>=s||T<0||y&&A>=i}function k(){var h=te();if(p(h))return O(h);t=setTimeout(k,b(h))}function O(h){return t=void 0,r&&a?_(h):(a=u=void 0,c)}function V(){t!==void 0&&clearTimeout(t),v=0,a=f=u=t=void 0}function P(){return t===void 0?c:O(te())}function j(){var h=te(),T=p(h);if(a=arguments,u=this,f=h,T){if(t===void 0)return w(f);if(y)return clearTimeout(t),t=setTimeout(k,s),_(f)}return t===void 0&&(t=setTimeout(k,s)),c}return j.cancel=V,j.flush=P,j}const H=e=>(de("data-v-3c7d874a"),e=e(),ue(),e),$t={key:0,class:"bubble"},Tt={key:0,class:"bubble"},Ct=["src"],jt={key:1,class:"flex items-center"},Pt=H(()=>o("div",{class:"i-mdi:image w-4 h-4"},null,-1)),At={key:1,class:"bubble"},Mt=["src"],It={key:1,class:"flex items-center"},Ot=H(()=>o("div",{class:"i-mdi:play-box w-4 h-4"},null,-1)),Vt={key:2,class:"bubble"},Ft=["src"],Bt={key:1,class:"flex items-center"},Et=H(()=>o("div",{class:"i-mdi:music-box w-4 h-4"},null,-1)),Lt={key:3,class:"bubble"},Nt=["href","download"],Rt=H(()=>o("div",{class:"i-mdi:file w-4 h-4 mr-1"},null,-1)),Ut={key:1,class:"flex items-center"},Dt=H(()=>o("div",{class:"i-mdi:file"},null,-1)),Wt=G({__name:"ChatList",props:{list:null},setup(e){const s=e,n=i=>{if(i instanceof Blob)return URL.createObjectURL(i);const c=new Blob([new Uint8Array(i).buffer]);return URL.createObjectURL(c)},a=x(),u=St(()=>{ke(()=>{var i,c;(c=(i=a.value)==null?void 0:i.lastElementChild)==null||c.scrollIntoView({behavior:"smooth"})})},100);return ye(()=>s.list.length,u),(i,c)=>(l(),d("div",{ref_key:"listEl",ref:a,class:"w-full h-full overflow-y-scroll pt-2"},[(l(!0),d(D,null,xe(e.list,(t,f)=>(l(),d("div",{key:t.id,class:U(["flex my-2 chat-item items-end",[t.byMe?"sended":"received"]])},[t.type===m(J).Text?(l(),d("div",$t,C(t.value),1)):t.type===m(J).File?(l(),d(D,{key:1},[t.fileType===m(K).Image?(l(),d("div",Tt,[t.received||t.byMe?(l(),d("img",{key:0,src:n(t.value),alt:""},null,8,Ct)):(l(),d("div",jt,[Pt,L(C(t.fileName),1)]))])):t.fileType===m(K).Video?(l(),d("div",At,[t.received||t.byMe?(l(),d("video",{key:0,controls:"",src:n(t.value),alt:""},null,8,Mt)):(l(),d("div",It,[Ot,L(C(t.fileName),1)]))])):t.fileType===m(K).Audio?(l(),d("div",Vt,[t.received||t.byMe?(l(),d("audio",{key:0,controls:"",src:n(t.value),alt:""},null,8,Ft)):(l(),d("div",Bt,[Et,L(C(t.fileName),1)]))])):t.fileType===m(K).File?(l(),d("div",Lt,[t.received||t.byMe?(l(),d("a",{key:0,class:"flex items-center rounded bg-white px-2 py-1 shadow",href:n(t.value),download:t.fileName,target:"_blank"},[Rt,L(C(t.fileName),1)],8,Nt)):(l(),d("div",Ut,[Dt,L(C(t.fileName),1)]))])):g("",!0)],64)):g("",!0),o("div",{class:U(["bg-gray mx-1",[t.received?"i-mdi:check-circle-outline":"i-mdi:checkbox-blank-circle-outline"]])},null,2)],2))),128))],512))}});const Gt=ve(Wt,[["__scopeId","data-v-3c7d874a"]]);var $=(e=>(e.Camera="Camera",e.Screen="Screen",e.Microphone="Microphone",e))($||{});const _e={income:void 0,name:void 0,answered:!1,type:void 0,localStream:void 0,remoteStream:void 0},W={onAccept:()=>{},onCancel:()=>{},onStop:()=>{},onReject:()=>{}},E=x({..._e}),ne=x(),Y=x(!1);let B;const I=()=>{Y.value=!1,E.value={..._e,...W},B==null||B()},Ht=(e,s)=>(Y.value=!0,{actionAccepted:new Promise((i,c)=>{E.value={income:!0,name:s,answered:!1,type:e,localStream:void 0,remoteStream:void 0,...W,onAccept:()=>{i(!0)},onReject:()=>{i(!1)}},B=c}),shiftToAnswerView:(i,c)=>new Promise((t,f)=>{B=f,E.value={income:!0,name:s,answered:!0,type:e,localStream:c,remoteStream:i,...W,onAccept:()=>{t()},onStop:()=>{t(),I()}}}),closePanel:()=>{I()}}),Kt=(e,s,n,a)=>(Y.value=!0,E.value={income:!1,name:s,answered:!1,type:e,localStream:n,remoteStream:void 0,...W,onCancel:()=>{a==null||a(),I()}},{shiftToAnswerView:c=>new Promise((f,v)=>{B=v,E.value={income:!1,name:s,answered:!0,type:e,localStream:n,remoteStream:c,...W,onAccept:()=>{},onStop:()=>{f(),I()},onCancel:()=>{v(),I()}}}),closePanel:()=>{I()}}),be=e=>(de("data-v-e75a4c24"),e=e(),ue(),e),zt={class:"call-panel w-full h-full backdrop-filter backdrop-blur rounded fixed top-0 flex place-center"},qt={class:"w-full h-full md:max-w-800px md:max-h-800px flex flex-col justify-between items-center pt-20 relative"},Jt={key:0,class:"text-lg font-semibold"},Xt={key:1,class:"text-lg"},Qt={key:2,class:"w-full h-full flex justify-center items-center"},Yt={class:"relative w-full"},Zt={class:"relative"},en=be(()=>o("div",{class:"i-mdi:phone-hangup w-8 h-8 bg-white"},null,-1)),tn=[en],nn=be(()=>o("div",{class:"i-mdi:phone w-8 h-8 bg-white"},null,-1)),sn=[nn],on=G({__name:"CallPanel",props:{income:{type:[Boolean,null]},name:null,answered:{type:[Boolean,null]},type:null,localStream:null,remoteStream:null,receiver:null,mute:{type:Boolean},videoSource:null},emits:["toggleMute","switchVideo"],setup(e,{emit:s}){const n=e,a=y=>{switch(y){case $.Camera:return M("video-call");case $.Screen:return M("screen-share");case $.Microphone:return M("phone-call");default:return""}},u=fe(()=>n.income&&!n.answered),i=()=>{if(n.answered){s("stop");return}if(n.income){s("reject");return}s("cancel")},c=()=>{s("accept")},t=x(!0),f=()=>{t.value=!t.value},v=x(),S=x();return ge(()=>{v.value&&n.localStream&&(v.value.srcObject=n.localStream,v.value.play()),S.value&&n.remoteStream&&(S.value.srcObject=n.remoteStream,S.value.play())}),(y,r)=>(l(),d("div",zt,[o("div",qt,[(!e.answered||!e.type)&&e.name?(l(),F(q,{key:0,name:e.name,class:"w-32 h-32"},null,8,["name"])):g("",!0),e.answered?g("",!0):(l(),d(D,{key:1},[e.income?(l(),d("div",Jt,C(y.$t("invites-you-to-join"))+" "+C(a(e.type)),1)):(l(),d("div",Xt,C(y.$t("waiting-for-answered")),1))],64)),e.answered?(l(),d("div",Qt,[o("div",{class:U(["video-view",{front:t.value}]),onClick:f},[o("div",Yt,[o("video",{ref_key:"otherVideoEl",ref:S,playsinline:"",class:"flex-1 w-full h-full rounded shadow-md"},null,512),e.name?(l(),F(q,{key:0,class:"w-10 absolute bottom-1 left-1 text-xs",name:e.name},null,8,["name"])):g("",!0)])],2),o("div",{class:U(["video-view w-full",{front:!t.value}]),onClick:f},[o("div",Zt,[se(o("video",{ref_key:"selfVideoEl",ref:v,playsinline:"",class:"flex-1 w-full h-full rounded shadow-md"},null,512),[[le,e.videoSource!==m(X).Display]]),e.name?(l(),F(q,{key:0,class:"w-10 h-10 absolute bottom-1 left-1 text-xs",name:"me"})):g("",!0)]),se(o("div",null,null,512),[[le,e.videoSource===m(X).Display]])],2)])):g("",!0),o("div",{class:U(["absolute bottom-20 flex w-full justify-between px-20 md:px-[30%] transition-all z-10",{"!px-[calc(50%-28px)]":!m(u)}])},[o("button",{class:"bg-red rounded-full w-14 h-14 flex-shrink-0 backdrop-filter backdrop-blur transition-all hover:scale-110 active:!scale-120 flex place-center",onClick:i},tn),m(u)?(l(),d("button",{key:0,class:"bg-green rounded-full w-14 h-14 flex-shrink-0 backdrop-filter backdrop-blur transition-all hover:scale-110 active:!scale-120 flex place-center",onClick:c},sn)):g("",!0)],2)])]))}});const ln=ve(on,[["__scopeId","data-v-e75a4c24"]]),an=G({__name:"CallPanelProvider",setup(e,{expose:s}){const n=r=>r===$.Camera?[X.Facial,void 0]:r===$.Screen?[X.Display,void 0]:[void 0,void 0],a=x();let u;Ve({onBeRequest:async(r,_,{type:w,name:b})=>{try{const{closePanel:p,shiftToAnswerView:k,actionAccepted:O}=Ht(w,b);if(!await O){_(),p();return}const P=n(w);f.value=P[0],v.value=Boolean(P[1]);const j=w===$.Screen?void 0:(await ae(...P)).stream,{remoteStream:h,close:T}=r(j),A=k(h,j);try{await A,T()}catch(Z){p()}j&&ee(j)}catch(p){_()}},onClose:()=>{u==null||u(),I()}});const{userInfo:i}=Fe(),{callPlugin:c}=Be();s({call:async r=>{R("Call",r,"Start");const _=n(r);f.value=_[0],v.value=Boolean(_[1]),a.value=await ae(..._),R("Call",r,"Stream_Success");const w=a.value.stream,{shiftToAnswerView:b,closePanel:p}=Kt(r,i.name,w,()=>{u==null||u()}),{stop:k,answered:O}=c.call(w,{type:r,name:i.name},r!==$.Screen);u=()=>{k(),ee(w)};let V=-1;try{const P=await O;V=Date.now(),R("Call",r,"Connect_Success"),await b(P),k()}catch(P){p()}V!==-1&&R("Call",r,`Connect_Duration_${((Date.now()-V)/1e3).toFixed(2)}`),ee(w)}});const f=x(),v=x(!1),S=async()=>{var r;await((r=a.value)==null?void 0:r.switchAudio(!v.value)),v.value=!v.value},y=async r=>{var _;await((_=a.value)==null?void 0:_.switchVideo(r)),f.value=r};return(r,_)=>(l(),F(je,{to:"body"},[z(Ce,{name:"slide"},{default:Se(()=>[m(Y)?(l(),F(ln,$e({key:0},m(E),{receiver:m(ne),"onUpdate:receiver":_[0]||(_[0]=w=>Te(ne)?ne.value=w:null),"video-source":f.value,mute:v.value,onToggleMute:S,onSwitchVideo:y}),null,16,["receiver","video-source","mute"])):g("",!0)]),_:1})]))}}),cn={class:"w-full h-full flex place-center"},rn={class:"w-full h-full md:max-w-800px md:max-h-800px flex flex-col"},dn={class:"flex place-center p-2 rounded md:shadow-md"},un=o("div",{class:"icon icon-base i-mdi:arrow-left"},null,-1),fn=[un],vn={class:"flex-1 flex justify-center items-center"},mn={class:"flex-1 flex justify-end"},hn=o("div",{class:"icon icon-base i-mdi:laptop"},null,-1),_n=[hn],bn=o("div",{class:"icon icon-base i-mdi:phone"},null,-1),pn=[bn],wn=o("div",{class:"icon icon-base i-mdi:video"},null,-1),yn=[wn],xn={class:"flex-1 overflow-y-hidden mb-2"},Sn=G({__name:"Chat",setup(e){var w;const{info:s,peek:n}=Ee(),a=fe(()=>{var b;return(b=s.value)==null?void 0:b.connectors[0]}),{messageList:u,messagePlugin:i,clear:c}=Le(),t=b=>{v.value||i.send(J.Text,b)},f=b=>{v.value||i.send(J.File,b)},v=x(!1);(w=n.connectionManager.getAll()[0])==null||w.once("close",()=>{Pe({content:M("connection-closed"),type:"warning"}),v.value=!0});const S=Ie(),y=async()=>{try{await Me({selections:[{label:M("no"),value:!1},{label:M("yes"),value:!0}],content:M("stop-connection-confirm-message"),showClose:!0,modalClose:!0})&&(n.connectionManager.getAll()[0].close(),S.replace("/"))}catch(b){}},r=x(),_=b=>{var p;v.value||((p=r.value)==null||p.call(b),R("Call",b,"Start"))};return Ae(()=>{c()}),(b,p)=>(l(),d(D,null,[o("div",cn,[o("div",rn,[o("div",dn,[o("div",{class:"flex-1 flex justify-start"},[o("button",{class:"icon-button",onClick:y},fn)]),o("div",vn,[m(a)?(l(),F(q,{key:0,preview:"",name:m(a).name,class:"h-10 !text-xs"},null,8,["name"])):g("",!0)]),o("div",mn,[m(Ne)?(l(),d(D,{key:0},[m(Re)?(l(),d("button",{key:0,class:"icon-button mr-1 md:mr-2",title:"share screen",onClick:p[0]||(p[0]=k=>_(m($).Screen))},_n)):g("",!0),o("button",{class:"icon-button mr-1 md:mr-2",title:"audio call",onClick:p[1]||(p[1]=k=>_(m($).Microphone))},pn),o("button",{class:"icon-button",title:"video call",onClick:p[2]||(p[2]=k=>_(m($).Camera))},yn)],64)):g("",!0)])]),o("div",xn,[z(Gt,{class:"px-2",list:m(u)},null,8,["list"])]),z(qe,{onSendText:t,onSendFile:f})])]),z(m(an),{ref_key:"callPanelProvider",ref:r},null,512)],64))}});export{Sn as default};
