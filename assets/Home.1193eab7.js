import{_ as G,a as F,b as S,r as se,c as oe,s as ne,P as H,d as O,u as ae,e as le,i as ce,f as re}from"./usePeek.4328d498.js";import{r as _,g as ie,o as Y,d as T,c as g,a as M,b as s,n as N,e as x,u as de,f as z,h as Q,i as ue,w as R,j as pe,k as $,l as ve,F as he,m as l,p as fe,q as me,_ as ye,s as V,t as q,v as A,x as _e,y as we,z as L,A as U,B as xe,C as be,D as ge}from"./index.7b360bb2.js";const ke=()=>{let e;return{sleep:o=>new Promise((a,r)=>{e=r,setTimeout(()=>{a()},o)}),stop:()=>{e==null||e()}}},Ce=(e,t)=>{const n=_(""),{splitter:o,charGapTime:a,lineGapTime:r,replayGapTime:u}={splitter:w=>w.split(""),charGapTime:500,lineGapTime:1e3,replayGapTime:2e3,...t},{sleep:c,stop:i}=ke(),p=async()=>{for await(const w of e){let h="";for await(const{char:k,index:P}of o(w).map((I,E)=>({char:I,index:E})))n.value=`${h}${k}`,await c(a),h=n.value;await c(r)}await c(u),d()},d=()=>{p().catch(()=>{})},m=()=>{i(),n.value=""};return ie()&&Y(()=>{m()}),{actText:n,stop:m,start:d}},Ie=T({__name:"Popover",props:{visible:{type:Boolean,default:!1},trigger:{default:"hover"},placement:{default:"bottom"},showDelay:{default:"0.2s"},hideDelay:{default:"0s"},offset:{default:"0px"},overlayClass:null},setup(e){return de(t=>({"539ec4f1":e.hideDelay,"373e2f03":e.offset,a16bb7d4:e.showDelay})),(t,n)=>(x(),g("div",{class:N(["popover",`trigger-${e.trigger}`]),tabindex:"0"},[M(t.$slots,"default",{},void 0,!0),s("div",{class:N(["popover-overlay",[e.placement,e.overlayClass,{"manual-hidden":e.trigger==="manual"&&!e.visible}]])},[M(t.$slots,"overlay",{},void 0,!0)],2)],2))}});const K=G(Ie,[["__scopeId","data-v-ba871690"]]),J=e=>(fe("data-v-58cc6fb5"),e=e(),me(),e),$e=["value","placeholder"],Se={class:"w-full min-h-10 bg-white shadow-xl rounded max-h-30 overflow-y-auto"},Te=J(()=>s("div",{class:"text-center py-1 text-stone-600 text-sm"},"History connections",-1)),Pe=["onClick"],Ee=["onClick"],Ae=J(()=>s("div",{class:"i-mdi:close"},null,-1)),Le=[Ae],Re=T({__name:"MainInput",props:{modelValue:null,history:null},emits:["update:modelValue","remove","select"],setup(e){const t=["Hello,-- this is Peek.","A-- simple-- p2p chat-- & file transfer app.","Paste-- your friends' id-- here,","Then-- click connect-- to enjoy!"],{actText:n,start:o,stop:a}=Ce(t,{splitter:c=>c.split("--")});z(()=>{o()});const r=_(),u=()=>{var c;(c=r.value)==null||c.$el.blur()};return(c,i)=>{var p;return x(),Q(K,{ref_key:"popoverEl",ref:r,trigger:"focus-within",class:"w-full z-1","overlay-class":"w-[calc(100%+8px)]"},ue({default:R(()=>[s("input",{value:e.modelValue,onInput:i[0]||(i[0]=d=>{var m;return c.$emit("update:modelValue",(m=d.target)==null?void 0:m.value)}),class:"primary-input my-1 w-full",type:"text",placeholder:l(n),onFocus:i[1]||(i[1]=(...d)=>l(a)&&l(a)(...d))},null,40,$e)]),_:2},[(p=e.history)!=null&&p.length?{name:"overlay",fn:R(()=>[s("div",Se,[Te,(x(!0),g(he,null,pe(e.history,(d,m)=>(x(),g("div",{class:"w-full flex items-center justify-between px-2 py-2 cursor-pointer hover:bg-stone-100 active:bg-stone-200",onClick:w=>{c.$emit("select",d.peerId),u()}},[$(F,{name:d.name,class:"w-10 h-10 text-sm"},null,8,["name"]),s("button",{class:"icon-button",onClick:ve(w=>c.$emit("remove",d.peerId),["stop"])},Le,8,Ee)],8,Pe))),256))])]),key:"0"}:void 0]),1536)}}});const Ve=G(Re,[["__scopeId","data-v-58cc6fb5"]]),Be=(e,t)=>{z(()=>{if(!e.value)return;const n=e.value,o=a=>{var r;n!==a.target&&((r=a.target)==null?void 0:r.contains(n))&&t()};window.addEventListener("click",o),Y(()=>{window.removeEventListener("click",o)})})},He=e=>{const t=document.createElement("input");return t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select(),new Promise((n,o)=>{try{const r=document.execCommand("copy")?"successful":"unsuccessful";n()}catch{o()}document.body.removeChild(t)})},W=e=>navigator.clipboard?navigator.clipboard.writeText(e):He(e),Oe=async(e,t,n={})=>{(await ye(()=>import("./browser.0efc6c6a.js").then(a=>a.b),[])).toCanvas(t,e,n,a=>{throw a})},Ne=(e,t=window.origin)=>{const n=new URLSearchParams;return Object.entries(e).forEach(([o,a])=>{n.append(o,a)}),`${t}?${n.toString()}`},Ue=(e=location.href)=>{const t=new URLSearchParams(new URL(e).search);return Object.fromEntries(t.entries())},je=()=>{history.replaceState({},"0",window.origin)},Me=["disabled"],De=["disabled"],Ge={class:"bg-gray-800 w-full p-4 rounded-t flex flex-col items-center justify-center"},Fe={class:"text-white text-center text-sm py-2 break-all"},Ye={class:"flex flex-col place-center px-4 py-2"},ze=s("div",{class:"font-bold py-1"},"Share link to friends",-1),Qe=s("div",{class:"i-mdi:share-variant w-5 h-5"},null,-1),qe=[Qe],Ke=s("div",{class:"i-mdi:content-copy w-5 h-5"},null,-1),Je=[Ke],We=s("div",{class:"i-mdi:email w-5 h-5"},null,-1),Xe=[We],Ze=s("div",{class:"text-xs text-center text-stone-600 py-1"}," The share link is generated, tell your friends to open it on browser. ",-1),et=T({__name:"ShareButton",props:{peerId:null},emits:["shared"],setup(e,{emit:t}){const n=e,o=_(!1),a=V(()=>!Boolean(n.peerId)),r=_();Be(r,async()=>{await we(),o.value===!0&&(o.value=!1)});const u=_(),c=()=>{o.value=!0,S("Share","Open_Share_Panel"),u.value||(u.value=se(4),t("shared",u.value))},i="Link to your friends - Peek",p=V(()=>Ne({targetId:n.peerId,ack:u.value})),d=async()=>{await W(p.value),L({content:"Copy link success"})},m=()=>{window.open(`mailto:?subject=${encodeURIComponent(i)}&body=${p.value}`)},w=Boolean(navigator.share),h=()=>{navigator.share({title:i,text:i,url:p.value})},k=_(),P=_(!0);return q(()=>[o.value,p.value],()=>{if(o.value&&p.value){if(!k.value)return;Oe(p.value,k.value),P.value=!0}}),(I,E)=>(x(),Q(K,{visible:o.value,trigger:"manual",placement:"top",offset:"-100px"},{overlay:R(()=>[s("div",{ref_key:"sharePanel",ref:r,class:"w-70 bg-white rounded-lg shadow-md flex flex-col place-center rounded cursor-pointer"},[s("div",Ge,[s("canvas",{ref_key:"codeEl",ref:k,class:"w-[180px] h-[180px]"},null,512),s("div",Fe,A(l(p)),1)]),s("div",Ye,[ze,s("div",null,[l(w)?(x(),g("button",{key:0,class:"icon-button mx-1",onClick:h},qe)):_e("",!0),s("button",{class:"icon-button mx-1",onClick:d},Je),s("button",{class:"icon-button mx-1",onClick:m},Xe)]),Ze])],512)]),default:R(()=>[s("button",{disabled:l(a),class:"icon-button w-12 flex place-center",title:"share",onClick:c},[s("button",{class:"i-mdi:ios-share w-6 h-6 disabled:bg-gray",disabled:l(a)},null,8,De)],8,Me)]),_:1},8,["visible"]))}}),tt=T({__name:"GuideButton",setup(e){const t=()=>{S("Guide","Show"),U({selections:["Ok"],content:"Peek can transfer data between you and your friend's device though P2P without server, including text, images, videos and any other files."})};return(n,o)=>(x(),g("div",{class:"text-sm text-stone-600 underline cursor-pointer",onClick:t},"what's this?"))}}),st="connect_user_history",[ot,D]=oe(st,()=>[]),nt=()=>{const e=_(ot()),t=o=>{n(o.peerId),e.value.push(o),D(e.value)},n=o=>{e.value=e.value.filter(a=>a.peerId!==o),D(e.value)};return{add:t,remove:n,history:xe(e)}},at=(e,t,n,o)=>new Promise((a,r)=>{const u=q(e,(c,i)=>{if((o===void 0||o===i)&&c===t){a(),u();return}c===n&&(r(),u())})}),lt=()=>({info:_(Ue()),clear:()=>{je()}}),ct={class:"w-full h-full flex justify-center"},rt={class:"p-4 w-full max-w-[400px] flex flex-col items-center"},it=s("div",{class:"header-placeholder flex-1 max-h-[10%]"},null,-1),dt={class:"w-full flex-shrink-0 mt-1 flex flex-col items-center justify-center"},ut={class:"py-1 truncate max-w-[90%]"},pt={class:"font-bold"},vt=s("div",{class:"text-light-700 text-sm"},"Your id:",-1),ht={class:"text-light-50 text-center font-bold px-1"},ft=s("div",{class:"text-light-700 text-sm"},"click to copy",-1),mt={key:1,class:"text-stone-500 text-sm text-white"},yt=["disabled"],_t={class:"pt-4"},wt={class:"pt-4"},xt=s("div",{class:"i-mdi:head-remove-outline w-5 h-5 bg-stone-500"},null,-1),bt=[xt],Ct=T({__name:"Home",setup(e){var j;const{add:t,remove:n,history:o}=nt(),a=V(()=>[...o.value.map(f=>({...f}))].reverse()),r=_(),{openStatus:u,connectStatus:c,info:i,peek:p}=ae();ne(async(f,v,y)=>{const b=async()=>{await f(),m.replace("/chat"),t({name:y.name,peerId:y.peerId})};if(y.acceptAck&&r.value&&y.acceptAck===r.value){await b();return}try{await U({selections:[{label:"Decline",value:!1},{label:"Accept",value:!0,entering:async()=>{await b()}}],content:`${y.name} wants to connect, confirm?`})||v()}catch{}});const{userInfo:d}=re(),m=ge(),w=async f=>{var y;if(!f)return;const{connect:v}=p.connectTo(f,{...d,media:le,acceptAck:(y=I.value)==null?void 0:y.ack});S("Communication","Start");try{const b=await v;m.replace("/chat"),t({name:b.name,peerId:h.value}),S("Communication","Success")}catch(b){if(ce(b)){L({type:"error",content:"connect rejected"});return}L({type:"error",content:"connect failed"})}},h=_(""),k=f=>{h.value=f},P=async()=>{w(h.value)},{info:I,clear:E}=lt(),X=at(u,O.Available,H.Spare);(j=I.value)!=null&&j.targetId&&(h.value=I.value.targetId,X.then(()=>{w(h.value)}),E());const Z=V(()=>u.value!==O.Available||c.value!==H.Spare||h.value.length===0),ee=async()=>{var f;(f=i.value)!=null&&f.peerId&&(await W(i.value.peerId),L({content:"copy id success"}))},te=async()=>{try{await U({selections:[{label:"Yes",value:!0},{label:"No",value:!1}],content:"This will clear all your history connections and reset your ID, Are you sure?",modalClose:!0,showClose:!0})&&(S("Reset"),localStorage.clear(),location.reload())}catch{}};return(f,v)=>{var y,b,B;return x(),g("div",ct,[s("div",rt,[it,s("div",dt,[$(F,{name:l(d).name,"onUpdate:name":v[0]||(v[0]=C=>l(d).name=C),editable:"",class:"h-20 text-xl"},null,8,["name"]),s("span",ut,[be("Hello, "),s("span",pt,A(l(d).name),1)])]),s("div",{class:N(["rounded-md flex flex-col place-center py-2 my-1 w-full min-h-20 cursor-pointer transition-all",[(y=l(i))!=null&&y.peerId?"bg-green-700":"bg-yellow-500"]])},[(b=l(i))!=null&&b.peerId?(x(),g("div",{key:0,class:"flex flex-col place-center",onClick:ee},[vt,s("div",ht,A(l(i).peerId),1),ft])):(x(),g("div",mt,"loading..."))],2),$(Ve,{modelValue:h.value,"onUpdate:modelValue":v[1]||(v[1]=C=>h.value=C),history:l(a),onRemove:l(n),onSelect:k},null,8,["modelValue","history","onRemove"]),s("button",{class:"primary-button my-1 w-full",disabled:l(Z),onClick:v[2]||(v[2]=C=>P())},A(l(c)===l(H).Connecting?"connecting...":l(u)===l(O).Initial?"waiting...":"connect"),9,yt),s("div",_t,[$(et,{"peer-id":(B=l(i))==null?void 0:B.peerId,onShared:v[3]||(v[3]=C=>r.value=C)},null,8,["peer-id"])]),s("div",wt,[$(tt)])]),s("button",{class:"absolute bottom-2 right-2 icon-button",title:"reset",onClick:v[4]||(v[4]=C=>te())},bt)])}}});export{Ct as default};
