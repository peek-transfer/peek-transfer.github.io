import{_ as F,a as z,b as E,r as se,P as U,c as H,u as oe,s as ne,d as ae,i as le,e as ce}from"./usePeek-162624c3.js";import{r as b,g as re,o as Q,d as P,c as C,a as j,b as s,n as N,e as g,u as ie,t as f,f as Y,h as q,i as de,w as B,j as w,k as ue,l as T,m as pe,F as ve,p as c,q as me,s as he,_ as fe,v as O,x as K,y as ye,z as _e,A as V,B as G,C as we,D as be,E as xe,G as ge}from"./index-8fcf0c3d.js";const $e=()=>{let e;return{sleep:o=>new Promise((a,i)=>{e=i,setTimeout(()=>{a()},o)}),stop:()=>{e==null||e()}}},ke=(e,t)=>{const n=b(""),{splitter:o,charGapTime:a,lineGapTime:i,replayGapTime:p}={splitter:x=>x.split(""),charGapTime:500,lineGapTime:1e3,replayGapTime:2e3,...t},{sleep:l,stop:d}=$e(),v=async()=>{for await(const x of e){let h="";for await(const{char:I,index:R}of o(x).map((k,L)=>({char:k,index:L})))n.value=`${h}${I}`,await l(a),h=n.value;await l(i)}await l(p),u()},u=()=>{v().catch(()=>{})},y=()=>{d(),n.value=""};return re()&&Q(()=>{y()}),{actText:n,stop:y,start:u}},Ce=P({__name:"Popover",props:{visible:{type:Boolean,default:!1},trigger:{default:"hover"},placement:{default:"bottom"},showDelay:{default:"0.2s"},hideDelay:{default:"0s"},offset:{default:"0px"},overlayClass:null},setup(e){return ie(t=>({"539ec4f1":e.hideDelay,"373e2f03":e.offset,a16bb7d4:e.showDelay})),(t,n)=>(g(),C("div",{class:N(["popover",`trigger-${e.trigger}`]),tabindex:"0"},[j(t.$slots,"default",{},void 0,!0),s("div",{class:N(["popover-overlay",[e.placement,e.overlayClass,{"manual-hidden":e.trigger==="manual"&&!e.visible}]])},[j(t.$slots,"overlay",{},void 0,!0)],2)],2))}});const J=F(Ce,[["__scopeId","data-v-ba871690"]]),Ie=e=>(me("data-v-8e27a71c"),e=e(),he(),e),Se=["value","placeholder"],Te={class:"w-full min-h-10 bg-white shadow-xl rounded max-h-30 overflow-y-auto"},Ee={class:"text-center py-1 text-stone-600 text-sm"},Pe=["onClick"],Re=["onClick"],Le=Ie(()=>s("div",{class:"i-mdi:close"},null,-1)),Ae=[Le],Ve=P({__name:"MainInput",props:{modelValue:null,history:null},emits:["update:modelValue","remove","select"],setup(e){const t=f("instruction-content").split("++"),{actText:n,start:o,stop:a}=ke(t,{splitter:l=>l.split("--")});Y(()=>{o()});const i=b(),p=()=>{var l;(l=i.value)==null||l.$el.blur()};return(l,d)=>{var v;return g(),q(J,{ref_key:"popoverEl",ref:i,trigger:"focus-within",class:"w-full z-1","overlay-class":"w-[calc(100%+8px)]"},de({default:B(()=>[s("input",{value:e.modelValue,onInput:d[0]||(d[0]=u=>{var y;return l.$emit("update:modelValue",(y=u.target)==null?void 0:y.value)}),class:"primary-input my-1 w-full",type:"text",placeholder:c(n),onFocus:d[1]||(d[1]=(...u)=>c(a)&&c(a)(...u))},null,40,Se)]),_:2},[(v=e.history)!=null&&v.length?{name:"overlay",fn:B(()=>[s("div",Te,[s("div",Ee,w(l.$t("history-connections")),1),(g(!0),C(ve,null,ue(e.history,(u,y)=>(g(),C("div",{class:"w-full flex items-center justify-between px-2 py-2 cursor-pointer hover:bg-stone-100 active:bg-stone-200",onClick:x=>{l.$emit("select",u.peerId),p()}},[T(z,{name:u.name,class:"w-10 h-10 text-sm"},null,8,["name"]),s("button",{class:"icon-button",onClick:pe(x=>l.$emit("remove",u.peerId),["stop"])},Ae,8,Re)],8,Pe))),256))])]),key:"0"}:void 0]),1536)}}});const Be=F(Ve,[["__scopeId","data-v-8e27a71c"]]),Oe=(e,t)=>{Y(()=>{if(!e.value)return;const n=e.value,o=a=>{var i;n!==a.target&&((i=a.target)!=null&&i.contains(n))&&t()};window.addEventListener("click",o),Q(()=>{window.removeEventListener("click",o)})})},Ue=e=>{const t=document.createElement("input");return t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select(),new Promise((n,o)=>{try{const i=document.execCommand("copy")?"successful":"unsuccessful";n()}catch(a){o()}document.body.removeChild(t)})},W=e=>navigator.clipboard?navigator.clipboard.writeText(e):Ue(e),He=async(e,t,n={})=>{(await fe(()=>import("./browser-bbd6b509.js").then(a=>a.b),[])).toCanvas(t,e,n,a=>{throw a})},Ne=(e,t=window.origin)=>{const n=new URLSearchParams;return Object.entries(e).forEach(([o,a])=>{n.append(o,a)}),`${t}?${n.toString()}`},Ge=(e=location.href)=>{const t=new URLSearchParams(new URL(e).search);return Object.fromEntries(t.entries())},Me=()=>{history.replaceState({},"0",window.origin)},je=["disabled"],De=["disabled"],Fe={class:"bg-gray-800 w-full p-4 rounded-t flex flex-col items-center justify-center"},ze={class:"text-white text-center text-sm py-2 break-all"},Qe={class:"flex flex-col place-center px-4 py-2"},Ye={class:"font-bold py-1"},qe=s("div",{class:"i-mdi:share-variant w-5 h-5"},null,-1),Ke=[qe],Je=s("div",{class:"i-mdi:content-copy w-5 h-5"},null,-1),We=[Je],Xe=s("div",{class:"i-mdi:email w-5 h-5"},null,-1),Ze=[Xe],et={class:"text-xs text-center text-stone-600 py-1"},tt=P({__name:"ShareButton",props:{peerId:null},emits:["shared"],setup(e,{emit:t}){const n=e,o=b(!1),a=O(()=>!Boolean(n.peerId)),i=b();Oe(i,async()=>{await _e(),o.value===!0&&(o.value=!1)});const p=b(),l=()=>{o.value=!0,E("Share","Open_Share_Panel"),p.value||(p.value=se(4),t("shared",p.value))},d=f("link-to-your-friends-peek"),v=O(()=>Ne({targetId:n.peerId,ack:p.value})),u=async()=>{await W(v.value),V({content:"Copy link success"})},y=()=>{window.open(`mailto:?subject=${encodeURIComponent(d)}&body=${v.value}`)},x=Boolean(navigator.share),h=()=>{navigator.share({title:d,text:d,url:v.value})},I=b(),R=b(!0);return K(()=>[o.value,v.value],()=>{if(o.value&&v.value){if(!I.value)return;He(v.value,I.value),R.value=!0}}),(k,L)=>(g(),q(J,{visible:o.value,trigger:"manual",placement:"top",offset:"-100px"},{overlay:B(()=>[s("div",{ref_key:"sharePanel",ref:i,class:"w-70 bg-white rounded-lg shadow-md flex flex-col place-center rounded cursor-pointer"},[s("div",Fe,[s("canvas",{ref_key:"codeEl",ref:I,class:"w-[180px] h-[180px]"},null,512),s("div",ze,w(c(v)),1)]),s("div",Qe,[s("div",Ye,w(k.$t("share-link-to-friends")),1),s("div",null,[c(x)?(g(),C("button",{key:0,class:"icon-button mx-1",onClick:h},Ke)):ye("",!0),s("button",{class:"icon-button mx-1",onClick:u},We),s("button",{class:"icon-button mx-1",onClick:y},Ze)]),s("div",et,w(k.$t("share-link-generated")),1)])],512)]),default:B(()=>[s("button",{disabled:c(a),class:"icon-button w-12 flex place-center",title:"share",onClick:l},[s("button",{class:"i-mdi:ios-share w-6 h-6 disabled:bg-gray",disabled:c(a)},null,8,De)],8,je)]),_:1},8,["visible"]))}}),st=P({__name:"GuideButton",setup(e){const t=()=>{E("Guide","Show"),G({selections:[f("ok")],content:f("peek-instruction")})};return(n,o)=>(g(),C("div",{class:"text-sm text-stone-600 underline cursor-pointer",onClick:t},w(n.$t("whats-this")),1))}}),ot="connect_user_history",[nt,D]=we(ot,()=>[]),at=()=>{const e=b(nt()),t=o=>{n(o.peerId),e.value.push(o),D(e.value)},n=o=>{e.value=e.value.filter(a=>a.peerId!==o),D(e.value)};return{add:t,remove:n,history:be(e)}},lt=(e,t,n,o)=>new Promise((a,i)=>{const p=K(e,(l,d)=>{if((o===void 0||o===d)&&l===t){a(),p();return}l===n&&(i(),p())})}),ct=()=>({info:b(Ge()),clear:()=>{Me()}}),rt={class:"w-full h-full flex justify-center"},it={class:"p-4 w-full max-w-[400px] flex flex-col items-center"},dt=s("div",{class:"header-placeholder flex-1 max-h-[10%]"},null,-1),ut={class:"w-full flex-shrink-0 mt-1 flex flex-col items-center justify-center"},pt={class:"py-1 truncate max-w-[90%]"},vt={class:"font-bold"},mt={class:"text-light-700 text-sm"},ht={class:"text-light-50 text-center font-bold px-1"},ft={class:"text-light-700 text-sm"},yt={key:1,class:"text-stone-500 text-sm text-white"},_t=["disabled"],wt={class:"pt-4"},bt={class:"pt-4"},xt=s("div",{class:"i-mdi:head-remove-outline w-5 h-5 bg-stone-500"},null,-1),gt=[xt],Ct=P({__name:"Home",setup(e){var M;const{add:t,remove:n,history:o}=at(),a=O(()=>[...o.value.map(r=>({...r}))].reverse()),i=b(),{openStatus:p,connectStatus:l,info:d,peek:v}=oe();ne(async(r,m,_)=>{const $=async()=>{await r(),y.replace("/chat"),t({name:_.name,peerId:_.peerId})};if(_.acceptAck&&i.value&&_.acceptAck===i.value){await $();return}try{await G({selections:[{label:f("decline"),value:!1},{label:f("accept"),value:!0,entering:async()=>{await $()}}],content:`${_.name} ${f("wants-to-connect-confirm")}`})||m()}catch(A){}});const{userInfo:u}=ce(),y=ge(),x=async r=>{var _;if(!r)return;const{connect:m}=v.connectTo(r,{...u,media:ae,acceptAck:(_=k.value)==null?void 0:_.ack});E("Communication","Start");try{const $=await m;y.replace("/chat"),t({name:$.name,peerId:h.value}),E("Communication","Success")}catch($){if(le($)){V({type:"error",content:f("connect-rejected")});return}V({type:"error",content:f("connect-failed")})}},h=b(""),I=r=>{h.value=r},R=async()=>{x(h.value)},{info:k,clear:L}=ct(),X=lt(p,H.Available,U.Spare);(M=k.value)!=null&&M.targetId&&(h.value=k.value.targetId,X.then(()=>{x(h.value)}),L());const Z=O(()=>p.value!==H.Available||l.value!==U.Spare||h.value.length===0),ee=async()=>{var r;(r=d.value)!=null&&r.peerId&&(await W(d.value.peerId),V({content:f("copy-id-success")}))},te=async()=>{try{await G({selections:[{label:f("yes"),value:!0},{label:f("no"),value:!1}],content:f("rest-confirm-message"),modalClose:!0,showClose:!0})&&(E("Reset"),localStorage.clear(),location.reload())}catch(r){}};return(r,m)=>{var _,$,A;return g(),C("div",rt,[s("div",it,[dt,s("div",ut,[T(z,{name:c(u).name,"onUpdate:name":m[0]||(m[0]=S=>c(u).name=S),editable:"",class:"h-20 text-xl"},null,8,["name"]),s("span",pt,[xe("Hello, "),s("span",vt,w(c(u).name),1)])]),s("div",{class:N(["rounded-md flex flex-col place-center py-2 my-1 w-full min-h-20 cursor-pointer transition-all",[(_=c(d))!=null&&_.peerId?"bg-green-700":"bg-yellow-500"]])},[($=c(d))!=null&&$.peerId?(g(),C("div",{key:0,class:"flex flex-col place-center",onClick:ee},[s("div",mt,w(r.$t("Your id:")),1),s("div",ht,w(c(d).peerId),1),s("div",ft,w(r.$t("click to copy")),1)])):(g(),C("div",yt,w(r.$t("loading"))+"...",1))],2),T(Be,{modelValue:h.value,"onUpdate:modelValue":m[1]||(m[1]=S=>h.value=S),history:c(a),onRemove:c(n),onSelect:I},null,8,["modelValue","history","onRemove"]),s("button",{class:"primary-button my-1 w-full",disabled:c(Z),onClick:m[2]||(m[2]=S=>R())},w(c(l)===c(U).Connecting?`${r.$t("connecting")}...`:c(p)===c(H).Initial?`${r.$t("waiting")}...`:r.$t("connect")),9,_t),s("div",wt,[T(tt,{"peer-id":(A=c(d))==null?void 0:A.peerId,onShared:m[3]||(m[3]=S=>i.value=S)},null,8,["peer-id"])]),s("div",bt,[T(st)])]),s("button",{class:"absolute bottom-2 right-2 icon-button",title:"reset",onClick:m[4]||(m[4]=S=>te())},gt)])}}});export{Ct as default};
