import{d as U,r as y,e as l,c as r,H as Z,I as _e,b as s,J as be,m as f,t as pe,F as R,j as we,y as ye,n as D,v as A,C as E,x,p as ce,q as re,s as de,K as xe,h as I,L as ne,k as K,w as ke,M as ge,N as Se,T as Ce,O as $e,z as Te,A as je,D as Pe}from"./index.f2a92685.js";import{g as Ae,M as G,F as H,_ as ue,a as z,V as q,h as Me,j as oe,k as se,b as L,f as Ie,l as Oe,u as Ve,e as Fe,m as Be,n as Ee}from"./usePeek.63f9f32e.js";const Ne={class:"flex flex-wrap justify-end rounded-lg bg-stone-200 m-2 p-2 rounded md:shadow-md"},Le=["onKeypress"],De={class:"flex items-center"},Re={class:"flex"},Ue=s("div",{class:"icon icon-base bg-stone-500 i-mdi:paperclip"},null,-1),We=[Ue],He=["disabled"],Ke=U({__name:"ChatInput",emits:["sendText","sendFile"],setup(e,{emit:o}){const n=y(""),d=()=>{n.value.length!==0&&(o("sendText",n.value),n.value="")},{showFilePicker:v,handleFileDrop:c}=Ae({onChange:u=>{o("sendFile",u)}});return(u,t)=>(l(),r("div",Ne,[Z(s("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>n.value=a),autofocus:"",class:"flex-1 bg-transparent outline-none",maxlength:"500",type:"text",placeholder:"Type here",onKeypress:be(d,["enter"])},null,40,Le),[[_e,n.value]]),s("div",De,[s("div",Re,[s("button",{class:"icon-contrast-button mr-2",onClick:t[1]||(t[1]=a=>f(v)())},We)]),s("button",{class:"primary-button",disabled:n.value.length===0,onClick:d},"send",8,He)])]))}});var ze=typeof global=="object"&&global&&global.Object===Object&&global;const Ge=ze;var qe=typeof self=="object"&&self&&self.Object===Object&&self,Je=Ge||qe||Function("return this")();const fe=Je;var Xe=fe.Symbol;const J=Xe;var ve=Object.prototype,Ye=ve.hasOwnProperty,Qe=ve.toString,N=J?J.toStringTag:void 0;function Ze(e){var o=Ye.call(e,N),n=e[N];try{e[N]=void 0;var d=!0}catch{}var v=Qe.call(e);return d&&(o?e[N]=n:delete e[N]),v}var et=Object.prototype,tt=et.toString;function nt(e){return tt.call(e)}var ot="[object Null]",st="[object Undefined]",le=J?J.toStringTag:void 0;function lt(e){return e==null?e===void 0?st:ot:le&&le in Object(e)?Ze(e):nt(e)}function at(e){return e!=null&&typeof e=="object"}var it="[object Symbol]";function ct(e){return typeof e=="symbol"||at(e)&&lt(e)==it}var rt=/\s/;function dt(e){for(var o=e.length;o--&&rt.test(e.charAt(o)););return o}var ut=/^\s+/;function ft(e){return e&&e.slice(0,dt(e)+1).replace(ut,"")}function ee(e){var o=typeof e;return e!=null&&(o=="object"||o=="function")}var ae=0/0,vt=/^[-+]0x[0-9a-f]+$/i,mt=/^0b[01]+$/i,ht=/^0o[0-7]+$/i,_t=parseInt;function ie(e){if(typeof e=="number")return e;if(ct(e))return ae;if(ee(e)){var o=typeof e.valueOf=="function"?e.valueOf():e;e=ee(o)?o+"":o}if(typeof e!="string")return e===0?e:+e;e=ft(e);var n=mt.test(e);return n||ht.test(e)?_t(e.slice(2),n?2:8):vt.test(e)?ae:+e}var bt=function(){return fe.Date.now()};const Y=bt;var pt="Expected a function",wt=Math.max,yt=Math.min;function xt(e,o,n){var d,v,c,u,t,a,w=0,k=!1,i=!1,m=!0;if(typeof e!="function")throw new TypeError(pt);o=ie(o)||0,ee(n)&&(k=!!n.leading,i="maxWait"in n,c=i?wt(ie(n.maxWait)||0,o):c,m="trailing"in n?!!n.trailing:m);function b(h){var g=d,M=v;return d=v=void 0,w=h,u=e.apply(M,g),u}function _(h){return w=h,t=setTimeout($,o),k?b(h):u}function p(h){var g=h-a,M=h-w,te=o-g;return i?yt(te,c-M):te}function C(h){var g=h-a,M=h-w;return a===void 0||g>=o||g<0||i&&M>=c}function $(){var h=Y();if(C(h))return j(h);t=setTimeout($,p(h))}function j(h){return t=void 0,m&&d?b(h):(d=v=void 0,u)}function T(){t!==void 0&&clearTimeout(t),w=0,d=a=v=t=void 0}function P(){return t===void 0?u:j(Y())}function B(){var h=Y(),g=C(h);if(d=arguments,v=this,a=h,g){if(t===void 0)return _(a);if(i)return clearTimeout(t),t=setTimeout($,o),b(a)}return t===void 0&&(t=setTimeout($,o)),u}return B.cancel=T,B.flush=P,B}const W=e=>(ce("data-v-3c7d874a"),e=e(),re(),e),kt={key:0,class:"bubble"},gt={key:0,class:"bubble"},St=["src"],Ct={key:1,class:"flex items-center"},$t=W(()=>s("div",{class:"i-mdi:image w-4 h-4"},null,-1)),Tt={key:1,class:"bubble"},jt=["src"],Pt={key:1,class:"flex items-center"},At=W(()=>s("div",{class:"i-mdi:play-box w-4 h-4"},null,-1)),Mt={key:2,class:"bubble"},It=["src"],Ot={key:1,class:"flex items-center"},Vt=W(()=>s("div",{class:"i-mdi:music-box w-4 h-4"},null,-1)),Ft={key:3,class:"bubble"},Bt=["href","download"],Et=W(()=>s("div",{class:"i-mdi:file w-4 h-4 mr-1"},null,-1)),Nt={key:1,class:"flex items-center"},Lt=W(()=>s("div",{class:"i-mdi:file"},null,-1)),Dt=U({__name:"ChatList",props:{list:null},setup(e){const o=e,n=c=>{if(c instanceof Blob)return URL.createObjectURL(c);const u=new Blob([new Uint8Array(c).buffer]);return URL.createObjectURL(u)},d=y(),v=xt(()=>{ye(()=>{var c,u;(u=(c=d.value)==null?void 0:c.lastElementChild)==null||u.scrollIntoView({behavior:"smooth"})})},100);return pe(()=>o.list.length,v),(c,u)=>(l(),r("div",{ref_key:"listEl",ref:d,class:"w-full h-full overflow-y-scroll pt-2"},[(l(!0),r(R,null,we(e.list,(t,a)=>(l(),r("div",{key:t.id,class:D(["flex my-2 chat-item items-end",[t.byMe?"sended":"received"]])},[t.type===f(G).Text?(l(),r("div",kt,A(t.value),1)):t.type===f(G).File?(l(),r(R,{key:1},[t.fileType===f(H).Image?(l(),r("div",gt,[t.received||t.byMe?(l(),r("img",{key:0,src:n(t.value),alt:""},null,8,St)):(l(),r("div",Ct,[$t,E(A(t.fileName),1)]))])):t.fileType===f(H).Video?(l(),r("div",Tt,[t.received||t.byMe?(l(),r("video",{key:0,controls:"",src:n(t.value),alt:""},null,8,jt)):(l(),r("div",Pt,[At,E(A(t.fileName),1)]))])):t.fileType===f(H).Audio?(l(),r("div",Mt,[t.received||t.byMe?(l(),r("audio",{key:0,controls:"",src:n(t.value),alt:""},null,8,It)):(l(),r("div",Ot,[Vt,E(A(t.fileName),1)]))])):t.fileType===f(H).File?(l(),r("div",Ft,[t.received||t.byMe?(l(),r("a",{key:0,class:"flex items-center rounded bg-white px-2 py-1 shadow",href:n(t.value),download:t.fileName,target:"_blank"},[Et,E(A(t.fileName),1)],8,Bt)):(l(),r("div",Nt,[Lt,E(A(t.fileName),1)]))])):x("",!0)],64)):x("",!0),s("div",{class:D(["bg-gray mx-1",[t.received?"i-mdi:check-circle-outline":"i-mdi:checkbox-blank-circle-outline"]])},null,2)],2))),128))],512))}});const Rt=ue(Dt,[["__scopeId","data-v-3c7d874a"]]);var S=(e=>(e.Camera="Camera",e.Screen="Screen",e.Microphone="Microphone",e))(S||{});const me={income:void 0,name:void 0,answered:!1,type:void 0,localStream:void 0,remoteStream:void 0},F=y({...me}),Q=y(),X=y(!1);let O;const V=()=>{X.value=!1,F.value={...me},O==null||O()},Ut=(e,o)=>(X.value=!0,{actionAccepted:new Promise((c,u)=>{F.value={income:!0,name:o,answered:!1,type:e,localStream:void 0,remoteStream:void 0,onAccept:()=>{c(!0)},onReject:()=>{c(!1)}},O=u}),shiftToAnswerView:(c,u)=>new Promise((t,a)=>{O=a,F.value={income:!0,name:o,answered:!0,type:e,localStream:u,remoteStream:c,onAccept:()=>{t()},onStop:()=>{t(),V()}}}),closePanel:()=>{V()}}),Wt=(e,o,n)=>(X.value=!0,F.value={income:!1,name:o,answered:!1,type:e,localStream:n,remoteStream:void 0,onCancel:()=>{}},{shiftToAnswerView:c=>new Promise((t,a)=>{O=a,F.value={income:!1,name:o,answered:!0,type:e,localStream:n,remoteStream:c,onAccept:()=>{},onStop:()=>{t(),V()},onCancel:()=>{a(),V()}}}),closePanel:()=>{V()}}),he=e=>(ce("data-v-db33e122"),e=e(),re(),e),Ht={class:"call-panel w-full h-full backdrop-filter backdrop-blur rounded fixed top-0 flex place-center"},Kt={class:"w-full h-full md:max-w-800px md:max-h-800px flex flex-col justify-between items-center pt-20 relative"},zt={key:0,class:"text-lg font-semibold"},Gt={key:1,class:"text-lg"},qt={key:2,class:"w-full h-full flex justify-center items-center"},Jt={class:"relative w-full"},Xt={class:"relative"},Yt=he(()=>s("div",{class:"i-mdi:phone-hangup w-8 h-8 bg-white"},null,-1)),Qt=[Yt],Zt=he(()=>s("div",{class:"i-mdi:phone w-8 h-8 bg-white"},null,-1)),en=[Zt],tn=U({__name:"CallPanel",props:{income:{type:[Boolean,null]},name:null,answered:{type:[Boolean,null]},type:null,localStream:null,remoteStream:null,receiver:null,mute:{type:Boolean},videoSource:null},emits:["toggleMute","switchVideo"],setup(e,{emit:o}){const n=e,d=i=>{switch(i){case S.Camera:return"video call";case S.Screen:return"screen share";case S.Microphone:return"phone call";default:return""}},v=de(()=>n.income&&!n.answered),c=()=>{if(n.answered){o("stop");return}if(n.income){o("reject");return}o("cancel")},u=()=>{o("accept")},t=y(!0),a=()=>{t.value=!t.value},w=y(),k=y();return xe(()=>{w.value&&n.localStream&&(w.value.srcObject=n.localStream,w.value.play()),k.value&&n.remoteStream&&(k.value.srcObject=n.remoteStream,k.value.play())}),(i,m)=>(l(),r("div",Ht,[s("div",Kt,[(!e.answered||!e.type)&&e.name?(l(),I(z,{key:0,name:e.name,class:"w-32 h-32"},null,8,["name"])):x("",!0),e.answered?x("",!0):(l(),r(R,{key:1},[e.income?(l(),r("div",zt,"Invites you to join "+A(d(e.type)),1)):(l(),r("div",Gt,"Waiting for answered"))],64)),e.answered?(l(),r("div",qt,[s("div",{class:D(["video-view",{front:t.value}]),onClick:a},[s("div",Jt,[s("video",{ref_key:"otherVideoEl",ref:k,playsinline:"",class:"flex-1 w-full h-full rounded shadow-md"},null,512),e.name?(l(),I(z,{key:0,class:"w-10 absolute bottom-1 left-1 text-xs",name:e.name},null,8,["name"])):x("",!0)])],2),s("div",{class:D(["video-view w-full",{front:!t.value}]),onClick:a},[s("div",Xt,[Z(s("video",{ref_key:"selfVideoEl",ref:w,playsinline:"",class:"flex-1 w-full h-full rounded shadow-md"},null,512),[[ne,e.videoSource!==f(q).Display]]),e.name?(l(),I(z,{key:0,class:"w-10 absolute bottom-1 left-1 text-xs",name:"me"})):x("",!0)]),Z(s("div",null,"Screen Sharing",512),[[ne,e.videoSource===f(q).Display]])],2)])):x("",!0),s("div",{class:D(["absolute bottom-20 flex w-full justify-between px-20 md:px-[30%] transition-all z-10",{"!px-[calc(50%-28px)]":!f(v)}])},[s("button",{class:"bg-red rounded-full w-14 h-14 flex-shrink-0 backdrop-filter backdrop-blur transition-all hover:scale-110 active:!scale-120 flex place-center",onClick:c},Qt),f(v)?(l(),r("button",{key:0,class:"bg-green rounded-full w-14 h-14 flex-shrink-0 backdrop-filter backdrop-blur transition-all hover:scale-110 active:!scale-120 flex place-center",onClick:u},en)):x("",!0)],2)])]))}});const nn=ue(tn,[["__scopeId","data-v-db33e122"]]),on=U({__name:"CallPanelProvider",setup(e,{expose:o}){const n=i=>i===S.Camera?[q.Facial,void 0]:i===S.Screen?[q.Display,void 0]:[void 0,void 0],d=y();Me({onBeRequest:async(i,m,{type:b,name:_})=>{try{const{closePanel:p,shiftToAnswerView:C,actionAccepted:$}=Ut(b,_);if(!await $){m(),p();return}const T=n(b);t.value=T[0],a.value=Boolean(T[1]);const P=b===S.Screen?void 0:(await oe(...T)).stream,{remoteStream:B,close:h}=i(P),g=C(B,P);try{await g,h()}catch{console.log("connection was hanged up by other side"),p()}P&&se(P)}catch{m()}},onClose:()=>{V()}});const{userInfo:v}=Ie(),{callPlugin:c}=Oe();o({call:async i=>{L("Call",i,"Start");const m=n(i);t.value=m[0],a.value=Boolean(m[1]),d.value=await oe(...m),L("Call",i,"Stream_Success");const b=d.value.stream,{shiftToAnswerView:_,closePanel:p}=Wt(i,v.name,b),{stop:C,answered:$}=c.call(b,{type:i,name:v.name});let j=-1;try{const T=await $;j=Date.now(),L("Call",i,"Connect_Success"),await _(T),C()}catch{console.log("connection was hanged up by other side"),p()}j!==-1&&L("Call",i,`Connect_Duration_${((Date.now()-j)/1e3).toFixed(2)}`),se(b)}});const t=y(),a=y(!1),w=async()=>{var i;await((i=d.value)==null?void 0:i.switchAudio(!a.value)),a.value=!a.value},k=async i=>{var m;await((m=d.value)==null?void 0:m.switchVideo(i)),t.value=i};return(i,m)=>(l(),I($e,{to:"body"},[K(Ce,{name:"slide"},{default:ke(()=>[f(X)?(l(),I(nn,ge({key:0},f(F),{receiver:f(Q),"onUpdate:receiver":m[0]||(m[0]=b=>Se(Q)?Q.value=b:null),"video-source":t.value,mute:a.value,onToggleMute:w,onSwitchVideo:k}),null,16,["receiver","video-source","mute"])):x("",!0)]),_:1})]))}}),sn={class:"w-full h-full flex place-center"},ln={class:"w-full h-full md:max-w-800px md:max-h-800px flex flex-col"},an={class:"flex place-center p-2 rounded md:shadow-md"},cn=s("div",{class:"icon icon-base i-mdi:arrow-left"},null,-1),rn=[cn],dn={class:"flex-1 flex justify-center items-center"},un={class:"flex-1 flex justify-end"},fn=s("div",{class:"icon icon-base i-mdi:laptop"},null,-1),vn=[fn],mn=s("div",{class:"icon icon-base i-mdi:phone"},null,-1),hn=[mn],_n=s("div",{class:"icon icon-base i-mdi:video"},null,-1),bn=[_n],pn={class:"flex-1 overflow-y-hidden mb-2"},xn=U({__name:"Chat",setup(e){var b;const{info:o,peek:n}=Ve(),d=de(()=>{var _;return(_=o.value)==null?void 0:_.connectors[0]}),{messageList:v,messagePlugin:c}=Ee(),u=_=>{a.value||c.send(G.Text,_)},t=_=>{a.value||c.send(G.File,_)},a=y(!1);(b=n.connectionManager.getAll()[0])==null||b.once("close",()=>{Te({content:"Connection closed",type:"warning"}),a.value=!0});const w=Pe(),k=async()=>{try{await je({selections:[{label:"No",value:!1},{label:"Yes",value:!0}],content:"Are you sure to stop this conversation? All messages will be lost.",showClose:!0,modalClose:!0})&&(n.connectionManager.getAll()[0].close(),w.replace("/"))}catch{}},i=y(),m=_=>{var p;a.value||((p=i.value)==null||p.call(_),L("Call",_,"Start"))};return(_,p)=>(l(),r(R,null,[s("div",sn,[s("div",ln,[s("div",an,[s("div",{class:"flex-1 flex justify-start"},[s("button",{class:"icon-button",onClick:k},rn)]),s("div",dn,[f(d)?(l(),I(z,{key:0,preview:"",name:f(d).name,class:"h-10 !text-xs"},null,8,["name"])):x("",!0)]),s("div",un,[f(Fe)?(l(),r(R,{key:0},[f(Be)?(l(),r("button",{key:0,class:"icon-button mr-1 md:mr-2",title:"share screen",onClick:p[0]||(p[0]=C=>m(f(S).Screen))},vn)):x("",!0),s("button",{class:"icon-button mr-1 md:mr-2",title:"audio call",onClick:p[1]||(p[1]=C=>m(f(S).Microphone))},hn),s("button",{class:"icon-button",title:"video call",onClick:p[2]||(p[2]=C=>m(f(S).Camera))},bn)],64)):x("",!0)])]),s("div",pn,[K(Rt,{class:"px-2",list:f(v)},null,8,["list"])]),K(Ke,{onSendText:u,onSendFile:t})])]),K(f(on),{ref_key:"callPanelProvider",ref:i},null,512)],64))}});export{xn as default};
