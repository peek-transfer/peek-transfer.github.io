import{d as G,r as y,e as l,c as u,J as oe,K as pe,b as s,L as we,p as m,j as T,x as ye,F as D,k as xe,z as ke,n as U,E as L,y as x,q as de,s as ue,v as fe,M as ge,h as F,N as le,t as M,l as H,w as Se,O as $e,P as Te,T as Ce,Q as je,A as Pe,B as Ae,G as Me}from"./index.5b4f51a1.js";import{f as Ie,M as J,F as z,_ as ve,a as q,V as Q,g as Oe,h as ae,j as ee,b as R,e as Ve,k as Fe,u as Be,d as Ee,l as Le,m as Ne}from"./usePeek.df2f7c00.js";const Re={class:"flex flex-wrap justify-end rounded-lg bg-stone-200 m-2 p-2 rounded md:shadow-md"},Ue=["onKeypress"],De={class:"flex items-center"},We={class:"flex"},Ge=s("div",{class:"icon icon-base bg-stone-500 i-mdi:paperclip"},null,-1),Ke=[Ge],ze=["disabled"],He=G({__name:"ChatInput",emits:["sendText","sendFile"],setup(e,{emit:o}){const n=y(""),a=()=>{n.value.length!==0&&(o("sendText",n.value),n.value="")},{showFilePicker:f,handleFileDrop:c}=Ie({onChange:r=>{o("sendFile",r)}});return(r,t)=>(l(),u("div",Re,[oe(s("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>n.value=d),autofocus:"",class:"flex-1 bg-transparent outline-none",maxlength:"500",type:"text",placeholder:"Type here",onKeypress:we(a,["enter"])},null,40,Ue),[[pe,n.value]]),s("div",De,[s("div",We,[s("button",{class:"icon-contrast-button mr-2",onClick:t[1]||(t[1]=d=>m(f)())},Ke)]),s("button",{class:"primary-button",disabled:n.value.length===0,onClick:a},T(r.$t("send")),9,ze)])]))}});var qe=typeof global=="object"&&global&&global.Object===Object&&global;const Je=qe;var Qe=typeof self=="object"&&self&&self.Object===Object&&self,Xe=Je||Qe||Function("return this")();const me=Xe;var Ye=me.Symbol;const X=Ye;var he=Object.prototype,Ze=he.hasOwnProperty,et=he.toString,N=X?X.toStringTag:void 0;function tt(e){var o=Ze.call(e,N),n=e[N];try{e[N]=void 0;var a=!0}catch{}var f=et.call(e);return a&&(o?e[N]=n:delete e[N]),f}var nt=Object.prototype,ot=nt.toString;function st(e){return ot.call(e)}var lt="[object Null]",at="[object Undefined]",ie=X?X.toStringTag:void 0;function it(e){return e==null?e===void 0?at:lt:ie&&ie in Object(e)?tt(e):st(e)}function ct(e){return e!=null&&typeof e=="object"}var rt="[object Symbol]";function dt(e){return typeof e=="symbol"||ct(e)&&it(e)==rt}var ut=/\s/;function ft(e){for(var o=e.length;o--&&ut.test(e.charAt(o)););return o}var vt=/^\s+/;function mt(e){return e&&e.slice(0,ft(e)+1).replace(vt,"")}function se(e){var o=typeof e;return e!=null&&(o=="object"||o=="function")}var ce=0/0,ht=/^[-+]0x[0-9a-f]+$/i,_t=/^0b[01]+$/i,bt=/^0o[0-7]+$/i,pt=parseInt;function re(e){if(typeof e=="number")return e;if(dt(e))return ce;if(se(e)){var o=typeof e.valueOf=="function"?e.valueOf():e;e=se(o)?o+"":o}if(typeof e!="string")return e===0?e:+e;e=mt(e);var n=_t.test(e);return n||bt.test(e)?pt(e.slice(2),n?2:8):ht.test(e)?ce:+e}var wt=function(){return me.Date.now()};const te=wt;var yt="Expected a function",xt=Math.max,kt=Math.min;function gt(e,o,n){var a,f,c,r,t,d,h=0,k=!1,p=!1,i=!0;if(typeof e!="function")throw new TypeError(yt);o=re(o)||0,se(n)&&(k=!!n.leading,p="maxWait"in n,c=p?xt(re(n.maxWait)||0,o):c,i="trailing"in n?!!n.trailing:i);function b(_){var $=a,A=f;return a=f=void 0,h=_,r=e.apply(A,$),r}function v(_){return h=_,t=setTimeout(C,o),k?b(_):r}function w(_){var $=_-d,A=_-h,Z=o-$;return p?kt(Z,c-A):Z}function S(_){var $=_-d,A=_-h;return d===void 0||$>=o||$<0||p&&A>=c}function C(){var _=te();if(S(_))return O(_);t=setTimeout(C,w(_))}function O(_){return t=void 0,i&&a?b(_):(a=f=void 0,r)}function V(){t!==void 0&&clearTimeout(t),h=0,a=d=f=t=void 0}function P(){return t===void 0?r:O(te())}function j(){var _=te(),$=S(_);if(a=arguments,f=this,d=_,$){if(t===void 0)return v(d);if(p)return clearTimeout(t),t=setTimeout(C,o),b(d)}return t===void 0&&(t=setTimeout(C,o)),r}return j.cancel=V,j.flush=P,j}const K=e=>(de("data-v-3c7d874a"),e=e(),ue(),e),St={key:0,class:"bubble"},$t={key:0,class:"bubble"},Tt=["src"],Ct={key:1,class:"flex items-center"},jt=K(()=>s("div",{class:"i-mdi:image w-4 h-4"},null,-1)),Pt={key:1,class:"bubble"},At=["src"],Mt={key:1,class:"flex items-center"},It=K(()=>s("div",{class:"i-mdi:play-box w-4 h-4"},null,-1)),Ot={key:2,class:"bubble"},Vt=["src"],Ft={key:1,class:"flex items-center"},Bt=K(()=>s("div",{class:"i-mdi:music-box w-4 h-4"},null,-1)),Et={key:3,class:"bubble"},Lt=["href","download"],Nt=K(()=>s("div",{class:"i-mdi:file w-4 h-4 mr-1"},null,-1)),Rt={key:1,class:"flex items-center"},Ut=K(()=>s("div",{class:"i-mdi:file"},null,-1)),Dt=G({__name:"ChatList",props:{list:null},setup(e){const o=e,n=c=>{if(c instanceof Blob)return URL.createObjectURL(c);const r=new Blob([new Uint8Array(c).buffer]);return URL.createObjectURL(r)},a=y(),f=gt(()=>{ke(()=>{var c,r;(r=(c=a.value)==null?void 0:c.lastElementChild)==null||r.scrollIntoView({behavior:"smooth"})})},100);return ye(()=>o.list.length,f),(c,r)=>(l(),u("div",{ref_key:"listEl",ref:a,class:"w-full h-full overflow-y-scroll pt-2"},[(l(!0),u(D,null,xe(e.list,(t,d)=>(l(),u("div",{key:t.id,class:U(["flex my-2 chat-item items-end",[t.byMe?"sended":"received"]])},[t.type===m(J).Text?(l(),u("div",St,T(t.value),1)):t.type===m(J).File?(l(),u(D,{key:1},[t.fileType===m(z).Image?(l(),u("div",$t,[t.received||t.byMe?(l(),u("img",{key:0,src:n(t.value),alt:""},null,8,Tt)):(l(),u("div",Ct,[jt,L(T(t.fileName),1)]))])):t.fileType===m(z).Video?(l(),u("div",Pt,[t.received||t.byMe?(l(),u("video",{key:0,controls:"",src:n(t.value),alt:""},null,8,At)):(l(),u("div",Mt,[It,L(T(t.fileName),1)]))])):t.fileType===m(z).Audio?(l(),u("div",Ot,[t.received||t.byMe?(l(),u("audio",{key:0,controls:"",src:n(t.value),alt:""},null,8,Vt)):(l(),u("div",Ft,[Bt,L(T(t.fileName),1)]))])):t.fileType===m(z).File?(l(),u("div",Et,[t.received||t.byMe?(l(),u("a",{key:0,class:"flex items-center rounded bg-white px-2 py-1 shadow",href:n(t.value),download:t.fileName,target:"_blank"},[Nt,L(T(t.fileName),1)],8,Lt)):(l(),u("div",Rt,[Ut,L(T(t.fileName),1)]))])):x("",!0)],64)):x("",!0),s("div",{class:U(["bg-gray mx-1",[t.received?"i-mdi:check-circle-outline":"i-mdi:checkbox-blank-circle-outline"]])},null,2)],2))),128))],512))}});const Wt=ve(Dt,[["__scopeId","data-v-3c7d874a"]]);var g=(e=>(e.Camera="Camera",e.Screen="Screen",e.Microphone="Microphone",e))(g||{});const _e={income:void 0,name:void 0,answered:!1,type:void 0,localStream:void 0,remoteStream:void 0},W={onAccept:()=>{},onCancel:()=>{},onStop:()=>{},onReject:()=>{}},E=y({..._e}),ne=y(),Y=y(!1);let B;const I=()=>{Y.value=!1,E.value={..._e,...W},B==null||B()},Gt=(e,o)=>(Y.value=!0,{actionAccepted:new Promise((c,r)=>{E.value={income:!0,name:o,answered:!1,type:e,localStream:void 0,remoteStream:void 0,...W,onAccept:()=>{c(!0)},onReject:()=>{c(!1)}},B=r}),shiftToAnswerView:(c,r)=>new Promise((t,d)=>{B=d,E.value={income:!0,name:o,answered:!0,type:e,localStream:r,remoteStream:c,...W,onAccept:()=>{t()},onStop:()=>{t(),I()}}}),closePanel:()=>{I()}}),Kt=(e,o,n,a)=>(Y.value=!0,E.value={income:!1,name:o,answered:!1,type:e,localStream:n,remoteStream:void 0,...W,onCancel:()=>{console.log("terminate call"),a==null||a(),I()}},{shiftToAnswerView:r=>new Promise((d,h)=>{B=h,E.value={income:!1,name:o,answered:!0,type:e,localStream:n,remoteStream:r,...W,onAccept:()=>{},onStop:()=>{d(),I()},onCancel:()=>{h(),I()}}}),closePanel:()=>{I()}}),be=e=>(de("data-v-e75a4c24"),e=e(),ue(),e),zt={class:"call-panel w-full h-full backdrop-filter backdrop-blur rounded fixed top-0 flex place-center"},Ht={class:"w-full h-full md:max-w-800px md:max-h-800px flex flex-col justify-between items-center pt-20 relative"},qt={key:0,class:"text-lg font-semibold"},Jt={key:1,class:"text-lg"},Qt={key:2,class:"w-full h-full flex justify-center items-center"},Xt={class:"relative w-full"},Yt={class:"relative"},Zt=be(()=>s("div",{class:"i-mdi:phone-hangup w-8 h-8 bg-white"},null,-1)),en=[Zt],tn=be(()=>s("div",{class:"i-mdi:phone w-8 h-8 bg-white"},null,-1)),nn=[tn],on=G({__name:"CallPanel",props:{income:{type:[Boolean,null]},name:null,answered:{type:[Boolean,null]},type:null,localStream:null,remoteStream:null,receiver:null,mute:{type:Boolean},videoSource:null},emits:["toggleMute","switchVideo"],setup(e,{emit:o}){const n=e,a=p=>{switch(p){case g.Camera:return M("video-call");case g.Screen:return M("screen-share");case g.Microphone:return M("phone-call");default:return""}},f=fe(()=>n.income&&!n.answered),c=()=>{if(n.answered){o("stop");return}if(n.income){o("reject");return}o("cancel")},r=()=>{o("accept")},t=y(!0),d=()=>{t.value=!t.value},h=y(),k=y();return ge(()=>{h.value&&n.localStream&&(h.value.srcObject=n.localStream,h.value.play()),k.value&&n.remoteStream&&(k.value.srcObject=n.remoteStream,k.value.play())}),(p,i)=>(l(),u("div",zt,[s("div",Ht,[(!e.answered||!e.type)&&e.name?(l(),F(q,{key:0,name:e.name,class:"w-32 h-32"},null,8,["name"])):x("",!0),e.answered?x("",!0):(l(),u(D,{key:1},[e.income?(l(),u("div",qt,T(p.$t("invites-you-to-join"))+" "+T(a(e.type)),1)):(l(),u("div",Jt,T(p.$t("waiting-for-answered")),1))],64)),e.answered?(l(),u("div",Qt,[s("div",{class:U(["video-view",{front:t.value}]),onClick:d},[s("div",Xt,[s("video",{ref_key:"otherVideoEl",ref:k,playsinline:"",class:"flex-1 w-full h-full rounded shadow-md"},null,512),e.name?(l(),F(q,{key:0,class:"w-10 absolute bottom-1 left-1 text-xs",name:e.name},null,8,["name"])):x("",!0)])],2),s("div",{class:U(["video-view w-full",{front:!t.value}]),onClick:d},[s("div",Yt,[oe(s("video",{ref_key:"selfVideoEl",ref:h,playsinline:"",class:"flex-1 w-full h-full rounded shadow-md"},null,512),[[le,e.videoSource!==m(Q).Display]]),e.name?(l(),F(q,{key:0,class:"w-10 h-10 absolute bottom-1 left-1 text-xs",name:"me"})):x("",!0)]),oe(s("div",null,null,512),[[le,e.videoSource===m(Q).Display]])],2)])):x("",!0),s("div",{class:U(["absolute bottom-20 flex w-full justify-between px-20 md:px-[30%] transition-all z-10",{"!px-[calc(50%-28px)]":!m(f)}])},[s("button",{class:"bg-red rounded-full w-14 h-14 flex-shrink-0 backdrop-filter backdrop-blur transition-all hover:scale-110 active:!scale-120 flex place-center",onClick:c},en),m(f)?(l(),u("button",{key:0,class:"bg-green rounded-full w-14 h-14 flex-shrink-0 backdrop-filter backdrop-blur transition-all hover:scale-110 active:!scale-120 flex place-center",onClick:r},nn)):x("",!0)],2)])]))}});const sn=ve(on,[["__scopeId","data-v-e75a4c24"]]),ln=G({__name:"CallPanelProvider",setup(e,{expose:o}){const n=i=>i===g.Camera?[Q.Facial,void 0]:i===g.Screen?[Q.Display,void 0]:[void 0,void 0],a=y();let f;Oe({onBeRequest:async(i,b,{type:v,name:w})=>{try{const{closePanel:S,shiftToAnswerView:C,actionAccepted:O}=Gt(v,w);if(!await O){b(),S();return}const P=n(v);d.value=P[0],h.value=Boolean(P[1]);const j=v===g.Screen?void 0:(await ae(...P)).stream,{remoteStream:_,close:$}=i(j),A=C(_,j);try{await A,$()}catch{console.log("connection was hanged up by other side"),S()}j&&ee(j)}catch{b()}},onClose:()=>{f==null||f(),I()}});const{userInfo:c}=Ve(),{callPlugin:r}=Fe();o({call:async i=>{R("Call",i,"Start");const b=n(i);d.value=b[0],h.value=Boolean(b[1]),a.value=await ae(...b),R("Call",i,"Stream_Success");const v=a.value.stream,{shiftToAnswerView:w,closePanel:S}=Kt(i,c.name,v,()=>{f==null||f()}),{stop:C,answered:O}=r.call(v,{type:i,name:c.name},i!==g.Screen);f=()=>{C(),ee(v)};let V=-1;try{const P=await O;V=Date.now(),R("Call",i,"Connect_Success"),await w(P),C()}catch{console.log("connection was hanged up by other side"),S()}V!==-1&&R("Call",i,`Connect_Duration_${((Date.now()-V)/1e3).toFixed(2)}`),ee(v)}});const d=y(),h=y(!1),k=async()=>{var i;await((i=a.value)==null?void 0:i.switchAudio(!h.value)),h.value=!h.value},p=async i=>{var b;await((b=a.value)==null?void 0:b.switchVideo(i)),d.value=i};return(i,b)=>(l(),F(je,{to:"body"},[H(Ce,{name:"slide"},{default:Se(()=>[m(Y)?(l(),F(sn,$e({key:0},m(E),{receiver:m(ne),"onUpdate:receiver":b[0]||(b[0]=v=>Te(ne)?ne.value=v:null),"video-source":d.value,mute:h.value,onToggleMute:k,onSwitchVideo:p}),null,16,["receiver","video-source","mute"])):x("",!0)]),_:1})]))}}),an={class:"w-full h-full flex place-center"},cn={class:"w-full h-full md:max-w-800px md:max-h-800px flex flex-col"},rn={class:"flex place-center p-2 rounded md:shadow-md"},dn=s("div",{class:"icon icon-base i-mdi:arrow-left"},null,-1),un=[dn],fn={class:"flex-1 flex justify-center items-center"},vn={class:"flex-1 flex justify-end"},mn=s("div",{class:"icon icon-base i-mdi:laptop"},null,-1),hn=[mn],_n=s("div",{class:"icon icon-base i-mdi:phone"},null,-1),bn=[_n],pn=s("div",{class:"icon icon-base i-mdi:video"},null,-1),wn=[pn],yn={class:"flex-1 overflow-y-hidden mb-2"},gn=G({__name:"Chat",setup(e){var b;const{info:o,peek:n}=Be(),a=fe(()=>{var v;return(v=o.value)==null?void 0:v.connectors[0]}),{messageList:f,messagePlugin:c}=Ne(),r=v=>{d.value||c.send(J.Text,v)},t=v=>{d.value||c.send(J.File,v)},d=y(!1);(b=n.connectionManager.getAll()[0])==null||b.once("close",()=>{Pe({content:M("connection-closed"),type:"warning"}),d.value=!0});const h=Me(),k=async()=>{try{await Ae({selections:[{label:M("no"),value:!1},{label:M("yes"),value:!0}],content:M("stop-connection-confirm-message"),showClose:!0,modalClose:!0})&&(n.connectionManager.getAll()[0].close(),h.replace("/"))}catch{}},p=y(),i=v=>{var w;d.value||((w=p.value)==null||w.call(v),R("Call",v,"Start"))};return(v,w)=>(l(),u(D,null,[s("div",an,[s("div",cn,[s("div",rn,[s("div",{class:"flex-1 flex justify-start"},[s("button",{class:"icon-button",onClick:k},un)]),s("div",fn,[m(a)?(l(),F(q,{key:0,preview:"",name:m(a).name,class:"h-10 !text-xs"},null,8,["name"])):x("",!0)]),s("div",vn,[m(Ee)?(l(),u(D,{key:0},[m(Le)?(l(),u("button",{key:0,class:"icon-button mr-1 md:mr-2",title:"share screen",onClick:w[0]||(w[0]=S=>i(m(g).Screen))},hn)):x("",!0),s("button",{class:"icon-button mr-1 md:mr-2",title:"audio call",onClick:w[1]||(w[1]=S=>i(m(g).Microphone))},bn),s("button",{class:"icon-button",title:"video call",onClick:w[2]||(w[2]=S=>i(m(g).Camera))},wn)],64)):x("",!0)])]),s("div",yn,[H(Wt,{class:"px-2",list:m(f)},null,8,["list"])]),H(He,{onSendText:r,onSendFile:t})])]),H(m(ln),{ref_key:"callPanelProvider",ref:p},null,512)],64))}});export{gn as default};
