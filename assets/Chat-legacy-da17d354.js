System.register(["./index-legacy-c669afa8.js","./usePeek-legacy-8660f37a.js"],(function(e,l){"use strict";var t,n,a,i,o,r,c,s,u,d,v,m,f,p,b,y,h,w,x,g,k,S,C,j,T,_,A,M,P,O,F,V,N,B,D,E,I,U,L,R,$,z,K,q,W,G,H,J,Q,X,Y=document.createElement("style");return Y.textContent=".chat-item .bubble[data-v-3c7d874a]{max-width:60%;overflow-wrap:break-word;border-radius:.375rem;padding:.5rem}.chat-item.sended[data-v-3c7d874a]{justify-content:flex-end}.chat-item.sended .bubble[data-v-3c7d874a]{border-bottom-right-radius:0;--un-bg-opacity:1;background-color:rgba(254,215,170,var(--un-bg-opacity))}.chat-item.received[data-v-3c7d874a]{flex-direction:row-reverse;justify-content:flex-end}.chat-item.received .bubble[data-v-3c7d874a]{border-bottom-left-radius:0;--un-bg-opacity:1;background-color:rgba(231,229,228,var(--un-bg-opacity))}.call-panel .video-view[data-v-e75a4c24]{position:absolute;top:.5rem;right:.5rem;z-index:2;min-width:10rem;min-height:7.5rem;max-width:10rem;max-height:7.5rem;display:flex;cursor:pointer;align-items:center;justify-content:center;border-radius:.25rem;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s;transition-duration:.5s}.call-panel .video-view.front[data-v-e75a4c24]{pointer-events:none;top:0;right:0;z-index:1;width:100%;height:100%;max-width:100%;max-height:100%}\n",document.head.appendChild(Y),{setters:[e=>{t=e.d,n=e.r,a=e.e,i=e.c,o=e.H,r=e.I,c=e.b,s=e.J,u=e.p,d=e.j,v=e.x,m=e.F,f=e.k,p=e.z,b=e.n,y=e.E,h=e.y,w=e.q,x=e.s,g=e.v,k=e.K,S=e.h,C=e.L,j=e.t,T=e.l,_=e.w,A=e.M,M=e.N,P=e.T,O=e.O,F=e.A,V=e.o,N=e.B,B=e.G},e=>{D=e.f,E=e.M,I=e.F,U=e._,L=e.a,R=e.V,$=e.g,z=e.h,K=e.j,q=e.b,W=e.e,G=e.k,H=e.u,J=e.l,Q=e.d,X=e.m}],execute:function(){const l={class:"flex flex-wrap justify-end rounded-lg bg-stone-200 m-2 p-2 rounded md:shadow-md"},Y=["onKeypress"],Z={class:"flex items-center"},ee={class:"flex"},le=[c("div",{class:"icon icon-base bg-stone-500 i-mdi:paperclip"},null,-1)],te=["disabled"],ne=t({__name:"ChatInput",emits:["sendText","sendFile"],setup(e,{emit:t}){const v=n(""),m=()=>{0!==v.value.length&&(t("sendText",v.value),v.value="")},{showFilePicker:f,handleFileDrop:p}=D({onChange:e=>{t("sendFile",e)}});return(e,t)=>(a(),i("div",l,[o(c("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),autofocus:"",class:"flex-1 bg-transparent outline-none",maxlength:"500",type:"text",placeholder:"Type here",onKeypress:s(m,["enter"])},null,40,Y),[[r,v.value]]),c("div",Z,[c("div",ee,[c("button",{class:"icon-contrast-button mr-2",onClick:t[1]||(t[1]=e=>u(f)())},le)]),c("button",{class:"primary-button",disabled:0===v.value.length,onClick:m},d(e.$t("send")),9,te)])]))}}),ae="object"==typeof global&&global&&global.Object===Object&&global;var ie="object"==typeof self&&self&&self.Object===Object&&self;const oe=ae||ie||Function("return this")(),re=oe.Symbol;var ce=Object.prototype,se=ce.hasOwnProperty,ue=ce.toString,de=re?re.toStringTag:void 0,ve=Object.prototype.toString,me="[object Null]",fe="[object Undefined]",pe=re?re.toStringTag:void 0;function be(e){return null==e?void 0===e?fe:me:pe&&pe in Object(e)?function(e){var l=se.call(e,de),t=e[de];try{e[de]=void 0;var n=!0}catch(i){}var a=ue.call(e);return n&&(l?e[de]=t:delete e[de]),a}(e):function(e){return ve.call(e)}(e)}var ye="[object Symbol]",he=/\s/,we=/^\s+/;function xe(e){return e?e.slice(0,function(e){for(var l=e.length;l--&&he.test(e.charAt(l)););return l}(e)+1).replace(we,""):e}function ge(e){var l=typeof e;return null!=e&&("object"==l||"function"==l)}var ke=NaN,Se=/^[-+]0x[0-9a-f]+$/i,Ce=/^0b[01]+$/i,je=/^0o[0-7]+$/i,Te=parseInt;function _e(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&be(e)==ye}(e))return ke;if(ge(e)){var l="function"==typeof e.valueOf?e.valueOf():e;e=ge(l)?l+"":l}if("string"!=typeof e)return 0===e?e:+e;e=xe(e);var t=Ce.test(e);return t||je.test(e)?Te(e.slice(2),t?2:8):Se.test(e)?ke:+e}const Ae=function(){return oe.Date.now()};var Me="Expected a function",Pe=Math.max,Oe=Math.min;function Fe(e,l,t){var n,a,i,o,r,c,s=0,u=!1,d=!1,v=!0;if("function"!=typeof e)throw new TypeError(Me);function m(l){var t=n,i=a;return n=a=void 0,s=l,o=e.apply(i,t)}function f(e){var t=e-c;return void 0===c||t>=l||t<0||d&&e-s>=i}function p(){var e=Ae();if(f(e))return b(e);r=setTimeout(p,function(e){var t=l-(e-c);return d?Oe(t,i-(e-s)):t}(e))}function b(e){return r=void 0,v&&n?m(e):(n=a=void 0,o)}function y(){var e=Ae(),t=f(e);if(n=arguments,a=this,c=e,t){if(void 0===r)return function(e){return s=e,r=setTimeout(p,l),u?m(e):o}(c);if(d)return clearTimeout(r),r=setTimeout(p,l),m(c)}return void 0===r&&(r=setTimeout(p,l)),o}return l=_e(l)||0,ge(t)&&(u=!!t.leading,i=(d="maxWait"in t)?Pe(_e(t.maxWait)||0,l):i,v="trailing"in t?!!t.trailing:v),y.cancel=function(){void 0!==r&&clearTimeout(r),s=0,n=c=a=r=void 0},y.flush=function(){return void 0===r?o:b(Ae())},y}const Ve=e=>(w("data-v-3c7d874a"),e=e(),x(),e),Ne={key:0,class:"bubble"},Be={key:0,class:"bubble"},De=["src"],Ee={key:1,class:"flex items-center"},Ie=Ve((()=>c("div",{class:"i-mdi:image w-4 h-4"},null,-1))),Ue={key:1,class:"bubble"},Le=["src"],Re={key:1,class:"flex items-center"},$e=Ve((()=>c("div",{class:"i-mdi:play-box w-4 h-4"},null,-1))),ze={key:2,class:"bubble"},Ke=["src"],qe={key:1,class:"flex items-center"},We=Ve((()=>c("div",{class:"i-mdi:music-box w-4 h-4"},null,-1))),Ge={key:3,class:"bubble"},He=["href","download"],Je=Ve((()=>c("div",{class:"i-mdi:file w-4 h-4 mr-1"},null,-1))),Qe={key:1,class:"flex items-center"},Xe=Ve((()=>c("div",{class:"i-mdi:file"},null,-1))),Ye=U(t({__name:"ChatList",props:{list:null},setup(e){const l=e,t=e=>{if(e instanceof Blob)return URL.createObjectURL(e);const l=new Blob([new Uint8Array(e).buffer]);return URL.createObjectURL(l)},o=n(),r=Fe((()=>{p((()=>{var e,l;null===(e=o.value)||void 0===e||null===(l=e.lastElementChild)||void 0===l||l.scrollIntoView({behavior:"smooth"})}))}),100);return v((()=>l.list.length),r),(l,n)=>(a(),i("div",{ref_key:"listEl",ref:o,class:"w-full h-full overflow-y-scroll pt-2"},[(a(!0),i(m,null,f(e.list,((e,l)=>(a(),i("div",{key:e.id,class:b(["flex my-2 chat-item items-end",[e.byMe?"sended":"received"]])},[e.type===u(E).Text?(a(),i("div",Ne,d(e.value),1)):e.type===u(E).File?(a(),i(m,{key:1},[e.fileType===u(I).Image?(a(),i("div",Be,[e.received||e.byMe?(a(),i("img",{key:0,src:t(e.value),alt:""},null,8,De)):(a(),i("div",Ee,[Ie,y(d(e.fileName),1)]))])):e.fileType===u(I).Video?(a(),i("div",Ue,[e.received||e.byMe?(a(),i("video",{key:0,controls:"",src:t(e.value),alt:""},null,8,Le)):(a(),i("div",Re,[$e,y(d(e.fileName),1)]))])):e.fileType===u(I).Audio?(a(),i("div",ze,[e.received||e.byMe?(a(),i("audio",{key:0,controls:"",src:t(e.value),alt:""},null,8,Ke)):(a(),i("div",qe,[We,y(d(e.fileName),1)]))])):e.fileType===u(I).File?(a(),i("div",Ge,[e.received||e.byMe?(a(),i("a",{key:0,class:"flex items-center rounded bg-white px-2 py-1 shadow",href:t(e.value),download:e.fileName,target:"_blank"},[Je,y(d(e.fileName),1)],8,He)):(a(),i("div",Qe,[Xe,y(d(e.fileName),1)]))])):h("",!0)],64)):h("",!0),c("div",{class:b(["bg-gray mx-1",[e.received?"i-mdi:check-circle-outline":"i-mdi:checkbox-blank-circle-outline"]])},null,2)],2)))),128))],512))}}),[["__scopeId","data-v-3c7d874a"]]);var Ze=(e=>(e.Camera="Camera",e.Screen="Screen",e.Microphone="Microphone",e))(Ze||{});const el={income:void 0,name:void 0,answered:!1,type:void 0,localStream:void 0,remoteStream:void 0},ll={onAccept:()=>{},onCancel:()=>{},onStop:()=>{},onReject:()=>{}},tl=n({...el}),nl=n(),al=n(!1);let il;const ol=()=>{var e;al.value=!1,tl.value={...el,...ll},null===(e=il)||void 0===e||e()},rl=e=>(w("data-v-e75a4c24"),e=e(),x(),e),cl={class:"call-panel w-full h-full backdrop-filter backdrop-blur rounded fixed top-0 flex place-center"},sl={class:"w-full h-full md:max-w-800px md:max-h-800px flex flex-col justify-between items-center pt-20 relative"},ul={key:0,class:"text-lg font-semibold"},dl={key:1,class:"text-lg"},vl={key:2,class:"w-full h-full flex justify-center items-center"},ml={class:"relative w-full"},fl={class:"relative"},pl=[rl((()=>c("div",{class:"i-mdi:phone-hangup w-8 h-8 bg-white"},null,-1)))],bl=[rl((()=>c("div",{class:"i-mdi:phone w-8 h-8 bg-white"},null,-1)))],yl=t({__name:"CallPanel",props:{income:{type:[Boolean,null]},name:null,answered:{type:[Boolean,null]},type:null,localStream:null,remoteStream:null,receiver:null,mute:{type:Boolean},videoSource:null},emits:["toggleMute","switchVideo"],setup(e,{emit:l}){const t=e,r=e=>{switch(e){case Ze.Camera:return j("video-call");case Ze.Screen:return j("screen-share");case Ze.Microphone:return j("phone-call");default:return""}},s=g((()=>t.income&&!t.answered)),v=()=>{t.answered?l("stop"):t.income?l("reject"):l("cancel")},f=()=>{l("accept")},p=n(!0),y=()=>{p.value=!p.value},w=n(),x=n();return k((()=>{w.value&&t.localStream&&(w.value.srcObject=t.localStream,w.value.play()),x.value&&t.remoteStream&&(x.value.srcObject=t.remoteStream,x.value.play())})),(l,t)=>(a(),i("div",cl,[c("div",sl,[e.answered&&e.type||!e.name?h("",!0):(a(),S(L,{key:0,name:e.name,class:"w-32 h-32"},null,8,["name"])),e.answered?h("",!0):(a(),i(m,{key:1},[e.income?(a(),i("div",ul,d(l.$t("invites-you-to-join"))+" "+d(r(e.type)),1)):(a(),i("div",dl,d(l.$t("waiting-for-answered")),1))],64)),e.answered?(a(),i("div",vl,[c("div",{class:b(["video-view",{front:p.value}]),onClick:y},[c("div",ml,[c("video",{ref_key:"otherVideoEl",ref:x,playsinline:"",class:"flex-1 w-full h-full rounded shadow-md"},null,512),e.name?(a(),S(L,{key:0,class:"w-10 absolute bottom-1 left-1 text-xs",name:e.name},null,8,["name"])):h("",!0)])],2),c("div",{class:b(["video-view w-full",{front:!p.value}]),onClick:y},[c("div",fl,[o(c("video",{ref_key:"selfVideoEl",ref:w,playsinline:"",class:"flex-1 w-full h-full rounded shadow-md"},null,512),[[C,e.videoSource!==u(R).Display]]),e.name?(a(),S(L,{key:0,class:"w-10 h-10 absolute bottom-1 left-1 text-xs",name:"me"})):h("",!0)]),o(c("div",null,null,512),[[C,e.videoSource===u(R).Display]])],2)])):h("",!0),c("div",{class:b(["absolute bottom-20 flex w-full justify-between px-20 md:px-[30%] transition-all z-10",{"!px-[calc(50%-28px)]":!u(s)}])},[c("button",{class:"bg-red rounded-full w-14 h-14 flex-shrink-0 backdrop-filter backdrop-blur transition-all hover:scale-110 active:!scale-120 flex place-center",onClick:v},pl),u(s)?(a(),i("button",{key:0,class:"bg-green rounded-full w-14 h-14 flex-shrink-0 backdrop-filter backdrop-blur transition-all hover:scale-110 active:!scale-120 flex place-center",onClick:f},bl)):h("",!0)],2)])]))}}),hl=U(yl,[["__scopeId","data-v-e75a4c24"]]),wl=t({__name:"CallPanelProvider",setup(e,{expose:l}){const t=e=>e===Ze.Camera?[R.Facial,void 0]:e===Ze.Screen?[R.Display,void 0]:[void 0,void 0],i=n();let o;$({onBeRequest:async(e,l,{type:n,name:a})=>{try{const{closePanel:o,shiftToAnswerView:r,actionAccepted:c}=((e,l)=>(al.value=!0,{actionAccepted:new Promise(((t,n)=>{tl.value={income:!0,name:l,answered:!1,type:e,localStream:void 0,remoteStream:void 0,...ll,onAccept:()=>{t(!0)},onReject:()=>{t(!1)}},il=n})),shiftToAnswerView:(t,n)=>new Promise(((a,i)=>{il=i,tl.value={income:!0,name:l,answered:!0,type:e,localStream:n,remoteStream:t,...ll,onAccept:()=>{a()},onStop:()=>{a(),ol()}}})),closePanel:()=>{ol()}}))(n,a);if(!(await c))return l(),void o();const u=t(n);s.value=u[0],d.value=Boolean(u[1]);const v=n===Ze.Screen?void 0:(await z(...u)).stream,{remoteStream:m,close:f}=e(v),p=r(m,v);try{await p,f()}catch(i){o()}v&&K(v)}catch(o){l()}},onClose:()=>{var e;null===(e=o)||void 0===e||e(),ol()}});const{userInfo:r}=W(),{callPlugin:c}=G();l({call:async e=>{q("Call",e,"Start");const l=t(e);s.value=l[0],d.value=Boolean(l[1]),i.value=await z(...l),q("Call",e,"Stream_Success");const n=i.value.stream,{shiftToAnswerView:a,closePanel:u}=((e,l,t,n)=>(al.value=!0,tl.value={income:!1,name:l,answered:!1,type:e,localStream:t,remoteStream:void 0,...ll,onCancel:()=>{null==n||n(),ol()}},{shiftToAnswerView:n=>new Promise(((a,i)=>{il=i,tl.value={income:!1,name:l,answered:!0,type:e,localStream:t,remoteStream:n,...ll,onAccept:()=>{},onStop:()=>{a(),ol()},onCancel:()=>{i(),ol()}}})),closePanel:()=>{ol()}}))(e,r.name,n,(()=>{var e;null===(e=o)||void 0===e||e()})),{stop:v,answered:m}=c.call(n,{type:e,name:r.name},e!==Ze.Screen);o=()=>{v(),K(n)};let f=-1;try{const l=await m;f=Date.now(),q("Call",e,"Connect_Success");const t=a(l);await t,v()}catch(p){u()}-1!==f&&q("Call",e,`Connect_Duration_${((Date.now()-f)/1e3).toFixed(2)}`),K(n)}});const s=n(),d=n(!1),v=async()=>{var e;await(null===(e=i.value)||void 0===e?void 0:e.switchAudio(!d.value)),d.value=!d.value},m=async e=>{var l;await(null===(l=i.value)||void 0===l?void 0:l.switchVideo(e)),s.value=e};return(e,l)=>(a(),S(O,{to:"body"},[T(P,{name:"slide"},{default:_((()=>[u(al)?(a(),S(hl,A({key:0},u(tl),{receiver:u(nl),"onUpdate:receiver":l[0]||(l[0]=e=>M(nl)?nl.value=e:null),"video-source":s.value,mute:d.value,onToggleMute:v,onSwitchVideo:m}),null,16,["receiver","video-source","mute"])):h("",!0)])),_:1})]))}}),xl={class:"w-full h-full flex place-center"},gl={class:"w-full h-full md:max-w-800px md:max-h-800px flex flex-col"},kl={class:"flex place-center p-2 rounded md:shadow-md"},Sl=[c("div",{class:"icon icon-base i-mdi:arrow-left"},null,-1)],Cl={class:"flex-1 flex justify-center items-center"},jl={class:"flex-1 flex justify-end"},Tl=[c("div",{class:"icon icon-base i-mdi:laptop"},null,-1)],_l=[c("div",{class:"icon icon-base i-mdi:phone"},null,-1)],Al=[c("div",{class:"icon icon-base i-mdi:video"},null,-1)],Ml={class:"flex-1 overflow-y-hidden mb-2"};e("default",t({__name:"Chat",setup(e){var l;const{info:t,peek:o}=H(),r=g((()=>{var e;return null===(e=t.value)||void 0===e?void 0:e.connectors[0]})),{messageList:s,messagePlugin:d,clear:v}=J(),f=e=>{b.value||d.send(E.Text,e)},p=e=>{b.value||d.send(E.File,e)},b=n(!1);null===(l=o.connectionManager.getAll()[0])||void 0===l||l.once("close",(()=>{F({content:j("connection-closed"),type:"warning"}),b.value=!0}));const y=B(),w=async()=>{try{await N({selections:[{label:j("no"),value:!1},{label:j("yes"),value:!0}],content:j("stop-connection-confirm-message"),showClose:!0,modalClose:!0})&&(o.connectionManager.getAll()[0].close(),y.replace("/"))}catch(e){}},x=n(),k=e=>{var l;b.value||(null===(l=x.value)||void 0===l||l.call(e),q("Call",e,"Start"))};return V((()=>{v()})),(e,l)=>(a(),i(m,null,[c("div",xl,[c("div",gl,[c("div",kl,[c("div",{class:"flex-1 flex justify-start"},[c("button",{class:"icon-button",onClick:w},Sl)]),c("div",Cl,[u(r)?(a(),S(L,{key:0,preview:"",name:u(r).name,class:"h-10 !text-xs"},null,8,["name"])):h("",!0)]),c("div",jl,[u(Q)?(a(),i(m,{key:0},[u(X)?(a(),i("button",{key:0,class:"icon-button mr-1 md:mr-2",title:"share screen",onClick:l[0]||(l[0]=e=>k(u(Ze).Screen))},Tl)):h("",!0),c("button",{class:"icon-button mr-1 md:mr-2",title:"audio call",onClick:l[1]||(l[1]=e=>k(u(Ze).Microphone))},_l),c("button",{class:"icon-button",title:"video call",onClick:l[2]||(l[2]=e=>k(u(Ze).Camera))},Al)],64)):h("",!0)])]),c("div",Ml,[T(Ye,{class:"px-2",list:u(s)},null,8,["list"])]),T(ne,{onSendText:f,onSendFile:p})])]),T(u(wl),{ref_key:"callPanelProvider",ref:x},null,512)],64))}}))}}}));
